/*!
 * form-create v1.5.4
 * (c) 2018-2019 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vue"),require("iview")):"function"==typeof define&&define.amd?define(["exports","vue","iview"],e):e(t.formCreate={},t.Vue,t.iview)}(this,function(t,e,o){"use strict";function r(t){e.nextTick(t)}function n(t,o,r){e.set(t,o,r)}function i(t,o){e.delete(t,o)}e=e&&e.hasOwnProperty("default")?e.default:e,o=o&&o.hasOwnProperty("default")?o.default:o;var a=Object.prototype.toString;function s(t){return null==t}function u(t){return null==t?"":"object"==typeof t?JSON.stringify(t,null,2):String(t)}function p(t,e){for(var o in e)n(t,o,e[o]);return t}function c(t){return"[object Date]"===a.call(t)}function l(t){return"[object Object]"===a.call(t)}function h(t){return"[object Function]"===a.call(t)}function f(t){return"[object String]"===a.call(t)}function d(t){return"[object Boolean]"===a.call(t)}function m(t){var e=t.replace(/([A-Z])/g,"-$1").toLowerCase();return 0===e.indexOf("-")&&(e=e.substr(1)),e}function y(t){return Array.isArray(t)?t:[t]}function v(t){return"object"==typeof t&&null!==t&&1===t.nodeType&&!l(t)}function _(t,e){void 0===e&&(e={});var o=!1;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=e[r];if((o=Array.isArray(i))||l(i)){var a=void 0===t[r];o?(o=!1,a&&n(t,r,[])):a&&n(t,r,{}),_(t[r],i)}else n(t,r,i)}return t}var g=0;function b(){return++g}var k=function(t,e,o,r,i){var a=function(t,e,o){var r={validate:[],event:{},col:{},emit:[],props:[],on:{},options:[],title:"",value:"",field:"",className:""};Object.keys(r).forEach(function(e){s(t[e])&&n(t,e,r[e])});var i={col:x(t.col),props:V(t.props),emitEvent:O(t.field,t.emitPrefix,t.emit,e),validate:w(t.validate),options:w(t.options)};i.event=p((l=t.event,Object.keys(l).forEach(function(t){var e=0===u(t).indexOf("on-")?t:"on-"+t;e!==t&&n(l,e,l[t])}),l),i.emitEvent),i.on=(a=t.on,c=i.emitEvent,Object.keys(c).length>0&&p(a,c),a),Object.keys(i).forEach(function(e){n(t,e,i[e])}),t.field||o||console.error("规则的 field 字段不能空\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");var a,c;var l;return t}(e,t,i);this.rule=a,this.noValue=i,this.type=u(a.type).toLowerCase(),this.isDef=!0,this.vm=t,this.el={},this.watch=[],this.root=[],this.origin=[],!a.field&&i?(this.field="tmp"+b(),this.isDef=!1):this.field=a.field,this.init(),this.refresh(),this.refName="__"+this.field+this.id,s(a.props.elementId)&&n(a.props,"elementId",this.unique),this.render=new o(t,this,r)};function w(t){return Array.isArray(t)?t:[]}function O(t,e,o,r){var n={};return Array.isArray(o)?(o.forEach(function(o){var i=m(t+"-"+o).replace("_","-"),a=e?(e+"-").toLowerCase()+m(o):e;n["on-"+o]=n[o]=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];r.$emit.apply(r,[i].concat(t)),a&&i!==a&&r.$emit.apply(r,[a].concat(t))}}),n):n}function V(t){return s(t.hidden)&&n(t,"hidden",!1),s(t.visibility)&&n(t,"visibility",!1),t}function x(t){return""!==(e=t)&&!isNaN(parseFloat(e))&&isFinite(e)?{span:t}:(void 0===t.span&&n(t,"span",24),t);var e}k.prototype.refresh=function(){var t=b();return this.id=t,this.unique="fc_"+t,this.key="key_"+t,this.parseValue=this.toFormValue(this.rule.value),this},k.prototype.init=function(){},k.prototype.toFormValue=function(t){return t},k.prototype.toValue=function(t){return t},k.prototype.setValue=function(t){this.rule.value=t,this.vm._changeValue(this.field,t)},k.prototype.getValue=function(){return this.vm._value(this.field)},k.prototype.watchValue=function(t){n(this.rule,"value",t),this.vm._changeFormData(this.field,this.toFormValue(t))},k.prototype.watchFormValue=function(t){},k.prototype.reset=function(){this.vm._changeValue(this.field,this.defaultValue)},k.prototype.mounted=function(){var t="fItem"+this.refName,e=this.vm,o=this.rule.children;this.el=e.$refs[this.refName],this.defaultValue=this.toValue(e.$refs[t]?e.$refs[t].initialValue:_({},{value:this.rule.value}).value),Array.isArray(o)&&o.length>0&&o.forEach(function(t){return!f(t)&&t.__handler__.mounted()})};var N=function(t){this.setVm(t)};N.prototype.setVm=function(t){this.vm=t,this.$h=t.$createElement},N.prototype.make=function(t,e,o){var r,n=this.$h(t,function(t){return f(t)?t={domProps:{innerHTML:t}}:t&&h(t.get)&&(t=t.get()),t}(e),h(r=o)?r():r||[]);return n.context=this.vm,n};var F={modal:"Modal",progress:"i-progress",button:"i-button",icon:"Icon",span:"span",slider:"Slider",rate:"Rate",upload:"Upload",cascader:"Cascader",colorPicker:"Color-Picker",timePicker:"Time-Picker",datePicker:"Date-Picker",switch:"i-switch",option:"i-option",select:"i-select",checkbox:"Checkbox",checkboxGroup:"Checkbox-Group",radio:"Radio",radioGroup:"Radio-Group",inputNumber:"Input-Number",input:"i-input",formItem:"Form-Item",form:"i-form",col:"i-col",row:"row",tree:"Tree",AutoComplete:"AutoComplete"};Object.keys(F).forEach(function(t){N.prototype[t]=function(e,o){return this.make(F[t],e,o)}});var P=function(){this.init()};P.prototype.class=function(t,e){var o=this;return void 0===e&&(e=!0),s(t)?this:(Array.isArray(t)?t.forEach(function(t){n(o._data.class,u(t),!0)}):l(t)?n(this._data,"class",p(this._data.class,t)):n(this._data.class,u(t),void 0===e||e),this)},P.prototype.directives=function(t){return s(t)?this:(n(this._data,"directives",this._data.directives.concat(y(t))),this)},P.prototype.init=function(){return this._data={class:{},style:{},attrs:{},props:{},domProps:{},on:{},nativeOn:{},directives:[],scopedSlots:{},slot:void 0,key:void 0,ref:void 0},this},P.prototype.get=function(){return this._prev=this._data,this.init(),this._prev};["ref","key","slot"].forEach(function(t){P.prototype[t]=function(e){return n(this._data,t,e),this}}),["scopedSlots","nativeOn","on","domProps","props","attrs","style"].forEach(function(t){P.prototype[t]=function(e,o){return s(e)?this:(l(e)?n(this._data,t,p(this._data[t],e)):n(this._data[t],u(e),o),this)}});var C=function(t,e,o){void 0===o&&(o={}),this.vm=t,this.handler=e,this.options=o,this.vNode=new N(t),this.vData=new P,this.cache=null,this.$tickEvent=[],this.init()};function I(t){return function(e,o,r,n){return void 0===n&&(n={}),new D(t,e,o,r,n)}}function j(t,e,o){return void 0===o&&(o="type"),function(r,n,i,a){void 0===a&&(a={});var s=new D(t,r,n,i,a);return h(e)?e(s):s.props(o,e),s}}C.prototype.init=function(){},C.prototype.cacheParse=function(t,e){var o=this.handler,n=o.noValue,i=o.noCache;this.cache&&!0!==n&&!0!==i||(this.cache=e?e.parse.call(this,t):this.parse(t));var a=[].concat(this.$tickEvent);return this.$tickEvent=[],a.length&&r(function(){a.forEach(function(t){return t()})}),this.cache},C.prototype.sync=function(t){h(t)&&this.$tickEvent.push(t),this.clearCache(),this.vm._sync()},C.prototype.clearCache=function(){this.cache=null;var t=this.handler.rule.children;Array.isArray(t)&&t.length>0&&t.forEach(function(t){return!f(t)&&t.__handler__.render.clearCache()})},C.prototype.parse=function(t){var o=this,r=this.handler,n=r.type,i=r.rule,a=r.refName,u=r.key,c=r.noValue,l=r.origin,h=r.root,d=r.vm;if("template"===i.type){if(void 0!==e.compile){s(i.vm)&&(i.vm=new e);var m=e.compile(i.template,{}).render.call(i.vm);return void 0===m.data&&(m.data={}),p(m.data,i),m.key=u,[m]}return console.error("使用的 Vue 版本不支持 compile\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com"),[]}if(c){i.ref=a,s(i.key)&&(i.key="def"+b());var y=this.vNode.make(n,Object.assign({},i),function(){var e=[],r=i.children||[];return Array.isArray(r)&&r.length>0&&(e=r.map(function(e){return f(e)?[e]:(e.__handler__||d._fComponent.createHandler([e],!0),e.__handler__.render.cacheParse(t,o))})),e});return y.key=u,[y]}return l.forEach(function(t){-1===h.indexOf(t)&&d._fComponent.removeField(t.__field__)}),this.handler.origin=[].concat(h),t.makeComponent(this.handler.render)},C.prototype.inputProps=function(){var t=this,e=this.handler,o=e.refName,r=e.key,n=e.field,i=e.rule,a=i.props,u=i.event,p=this.vData.props(a).props({value:this.vm._formData(n)}).ref(o).key(r+"fc"+n).on(u).on("input",function(e){t.onInput(e)});return s(a.size)&&p.props({size:this.options.form.size}),p},C.prototype.onInput=function(t){var e=this.handler,o=this.handler,r=o.field,n=o.vm,i=e.toValue(t);n._changeFormData(r,t),e.setValue(i),n._change(r,JSON.stringify(t)),e.watchFormValue(t)};var D=function(t){function e(e,o,r,n,i){void 0===i&&(i={}),t.call(this),this.rule=p({event:{},validate:[],options:[],col:{},children:[],emit:[],template:null,emitPrefix:null},{type:e,title:o,field:r,value:n}),this.props({hidden:!1,visibility:!1}),l(i)&&this.props(i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.type=function(t){return this.props("type",t),this},e.prototype.get=function(){return this._data},e.prototype.getRule=function(){return p(this.rule,this.get())},e.prototype.setValue=function(t){return n(this.rule,"value",t),this},e}(P);["emitPrefix","className","defaultSlot"].forEach(function(t){D.prototype[t]=function(e){return n(this.rule,t,e),this}});["event","col"].forEach(function(t){D.prototype[t]=function(e){return n(this.rule,t,p(this.rule[t],e)),this}});["validate","options","children","emit"].forEach(function(t){D.prototype[t]=function(e){return Array.isArray(e)||(e=[e]),n(this.rule,t,this.rule[t].concat(e)),this}});var E={hidden:function(t,e){return I("hidden")("",t,e)}},A={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){return[]},e}(C),name:"hidden",maker:E},$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this.rule.props;t.autosize&&t.autosize.minRows&&n(t,"rows",t.autosize.minRows||2)},e.prototype.toFormValue=function(t){return u(t)},e}(k),R=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){return[this.vNode.input(this.inputProps().get())]},e}(C),S=["password","url","email","text"].reduce(function(t,e){return t[e]=j("input",e),t},{});S.idate=j("input","date");var q={render:R,handler:$,name:"input",maker:S},B={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toFormValue=function(t){return this.rule.options.filter(function(e){return e.value===t}).reduce(function(t,e){return e.label},"")},e.prototype.toValue=function(t){return this.rule.options.filter(function(e){return e.label===t}).reduce(function(t,e){return e.value},"")},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){var t=this,e=this.handler,o=e.unique,r=e.rule.options;return[this.vNode.radioGroup(this.inputProps().get(),function(){return r.map(function(e,r){var n=Object.assign({},e);return delete n.value,t.vNode.radio({props:n,key:"ropt"+r+o})})})]},e}(C),name:"radio"},L={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toFormValue=function(t){return t?Array.isArray(t)||(t=[t]):t=[],this.rule.options.filter(function(e){return-1!==t.indexOf(e.value)}).map(function(t){return t.label})},e.prototype.toValue=function(t){var e=this.rule.options.filter(function(e){return-1!==t.indexOf(e.label)}).map(function(t){return t.value});return 1===this.rule.options.length?void 0===e[0]?"":e[0]:e},e.prototype.watchFormValue=function(e){t.prototype.watchFormValue.call(this,e),this.render.sync()},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){var t=this,e=this.handler,o=e.unique,r=e.rule.options,n=e.key;return[this.vNode.checkboxGroup(this.inputProps().key(n).get(),function(){return r.map(function(e,r){var n=Object.assign({},e);return delete n.value,t.vNode.checkbox({props:n,key:"copt"+r+o})})})]},e}(C),name:"checkbox"},T={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){void 0===this.rule.slot&&n(this.rule,"slot",{})},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){var t=this.handler.rule,e=s(t.props.slot)?t.slot:t.props.slot;return[this.vNode.switch(this.inputProps().scopedSlots({open:function(){return e.open},close:function(){return e.close}}).style({margin:"4.5px 0px"}).get())]},e}(C),name:"switch"},H={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toFormValue=function(t){var e=Array.isArray(t);return!0===this.rule.props.multiple?!0===e?t:[t]:!0===e?t[0]||"":t},e.prototype.watchFormValue=function(e){t.prototype.watchFormValue.call(this,e),this.render.sync()},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){var t=this,e=this.handler,o=e.unique,r=e.rule;return[this.vNode.select(this.inputProps().get(),function(){return r.options.map(function(e,n){return t.vNode.option({props:e,key:"sopt"+n+o},_t(e.slot,t.vm.$createElement,r))})})]},e}(C),name:"select",maker:{selectMultiple:j("select",!0,"multiple"),selectOne:j("select",!1,"multiple")}},M={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this.rule.props;n(t,"type",t.type?u(t.type).toLowerCase():"date"),s(t.startDate)&&n(t,"startDate",gt(t.startDate))},e.prototype.toFormValue=function(t){var e,o=Array.isArray(t),r=this.rule.props;return e=-1!==["daterange","datetimerange"].indexOf(r.type)?o?t.map(function(t){return t?gt(t):""}):["",""]:"date"===r.type&&!0===r.multiple?u(t):(e=o?t[0]||"":t)?gt(e):""},e.prototype.toValue=function(){return this.el.publicStringValue},e.prototype.mounted=function(){t.prototype.mounted.call(this),this.rule.value=this.el.publicStringValue,this.vm._changeFormData(this.field,this.toFormValue(this.el.publicStringValue))},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){var t=this.handler,e=t.key,o=t.rule,r=t.vm;return[this.vNode.datePicker(this.inputProps().key(e).get(),_t(o.defaultSlot,r.$createElement,o))]},e}(C),name:"datePicker",maker:["date","dateRange","dateTime","dateTimeRange","year","month"].reduce(function(t,e){return t[e]=j("datePicker",e.toLowerCase()),t},{})};function U(t){return c(t)?function(t,e){void 0===e&&(e=new Date);var o={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[r]:("00"+o[r]).substr((""+o[r]).length)));return t}("hh:mm:ss",t):t}var z={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this.rule.props;t.type||n(t,"type","time"),s(t.confirm)&&n(t,"confirm",!0)},e.prototype.toFormValue=function(t){var e,o=Array.isArray(t);return"timerange"===this.rule.props.type?e=o?t.map(function(t){return t?U(gt(t)):""}):["",""]:(o&&(t=t[0]),e=t?U(gt(t)):""),e},e.prototype.mounted=function(){t.prototype.mounted.call(this),this.rule.value=this.el.publicStringValue,this.vm._changeFormData(this.field,this.toFormValue(this.el.publicStringValue))},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){var t=this.handler,e=t.key,o=t.rule,r=t.vm;return[this.vNode.timePicker(this.inputProps().key(e).get(),_t(o.defaultSlot,r.$createElement,o))]},e}(C),maker:{time:j("timePicker","time"),timeRange:j("timePicker","timerange")},name:"timePicker"},G={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toFormValue=function(t){var e=parseFloat(t);return Number.isNaN(e)&&(e=0),e},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){return[this.vNode.inputNumber(this.inputProps().get())]},e}(C),name:"inputNumber",maker:{number:I("inputNumber")}},W={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.watchFormValue=function(e){t.prototype.watchFormValue.call(this,e),this.render.sync()},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){return[this.vNode.colorPicker(this.inputProps().key(this.handler.key).get())]},e}(C),name:"colorPicker",maker:{color:I("colorPicker")}};function J(t){return Array.isArray(t)?t:t?[t]:[]}var Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this.rule.props;n(t,"defaultFileList",[]),s(t.showUploadList)&&n(t,"showUploadList",!1),s(t.uploadType)&&n(t,"uploadType","file"),void 0===t.maxLength&&n(t,"maxLength",0),void 0===t.action&&n(t,"action",""),"file"===t.uploadType&&void 0===t.handleIcon&&n(t,"handleIcon",!1),n(this.rule,"value",J(this.rule.value)),this.parseValue=[]},e.prototype.toFormValue=function(t){var e=this,o=J(t);return this.parseValue.splice(0,this.parseValue.length),o.forEach(function(t){return e.push(t)}),n(this.rule.props,"defaultFileList",this.parseValue),this.parseValue},e.prototype.mounted=function(){t.prototype.mounted.call(this),n(this.rule.props,"defaultFileList",this.parseValue),this.changeParseValue(this.el.fileList)},e.prototype.push=function(t){var e;this.parseValue.push({url:t,name:(e=t,u(e).split("/").pop())})},e.prototype.toValue=function(t){if(s(t))return[];var e=t.map(function(t){return t.url}).filter(function(t){return void 0!==t});return 1===this.rule.props.maxLength?e[0]||"":e},e.prototype.changeParseValue=function(t){this.parseValue=t,this.vm._changeFormData(this.field,t)},e.prototype.watchValue=function(e){var o=!0;this.rule.props.defaultFileList.forEach(function(t){o=o&&(void 0===t.percentage||"finished"===t.status)}),o&&t.prototype.watchValue.call(this,e)},e}(k),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this,e=this.handler;this.uploadOptions=p(Object.assign({},this.options.upload),this.handler.rule.props),this.issetIcon=this.uploadOptions.allowRemove||this.uploadOptions.handleIcon,this.propsData=this.vData.props(this.uploadOptions).props("onSuccess",function(){for(var e,o=[],r=arguments.length;r--;)o[r]=arguments[r];return(e=t).onSuccess.apply(e,o)}).props("onRemove",function(){for(var e,o=[],r=arguments.length;r--;)o[r]=arguments[r];return(e=t).onRemove.apply(e,o)}).ref(e.refName).key("fip"+e.unique).get()},e.prototype.onRemove=function(){for(var t,e=[],o=arguments.length;o--;)e[o]=arguments[o];this.handler.changeParseValue(this.handler.el.fileList),this.uploadOptions.onRemove&&(t=this.uploadOptions).onRemove.apply(t,e),this.sync()},e.prototype.onSuccess=function(t,e,o){var r=this.uploadOptions.onSuccess.call(null,t,e,o);if(s(r)){var n=o.indexOf(e);-1!==n&&o.splice(n,1)}else e.url=r,e.showProgress=!1;this.handler.changeParseValue(this.handler.el.fileList)},e.prototype.defaultOnHandle=function(t){var e=this;this.vm.$Modal.remove(),setTimeout(function(){e.vm.$Modal.info({title:"预览",render:function(e){return e("img",{attrs:{src:t},style:"width: 100%",key:"ifmd"+b()})},showCancel:!0,closable:!0,scrollable:!0})},301)},e.prototype.onHandle=function(t){var e=this.uploadOptions.onHandle;if(e)return e(t);this.defaultOnHandle(t)},e.prototype.parse=function(){var t=this,e=this.handler,o=e.unique,r=e.field;this.init(),!0===this.uploadOptions.handleIcon&&(this.uploadOptions.handleIcon="ios-eye-outline");var n=this.vm._formData(r),i=this.uploadOptions.showUploadList?[]:[].concat(n.map(function(e,r){return e.showProgress?t.makeProgress(e,"uppg"+r+o):void 0===e.status||"finished"===e.status?t.makeUploadView(e.url,"upview"+r+o,r):void 0})),a=!this.uploadOptions.maxLength||this.uploadOptions.maxLength>n.length;return i.push(this.makeUploadBtn(o,a)),[this.vNode.make("div",{key:"div4"+o,class:{"fc-upload":!0,"fc-hide-btn":!a}},i)]},e.prototype.cacheParse=function(e){return this.cache=null,t.prototype.cacheParse.call(this,e)},e.prototype.makeUploadView=function(t,e,o){var r=this;return this.vNode.make("div",{key:"div1"+e,class:{"fc-files":!0}},function(){var n=[];return"image"===r.handler.rule.props.uploadType?n.push(r.vNode.make("img",{key:"img"+e,attrs:{src:t}})):n.push(r.vNode.icon({key:"file"+e,props:{type:dt.fileIcon,size:40}})),r.issetIcon&&n.push(r.makeIcons(t,e,o)),n})},e.prototype.makeIcons=function(t,e,o){var r=this;return this.vNode.make("div",{key:"div2"+e,class:{"fc-upload-cover":!0}},function(){var n=[];return r.uploadOptions.handleIcon&&n.push(r.makeHandleIcon(t,e,o)),!0===r.uploadOptions.allowRemove&&n.push(r.makeRemoveIcon(t,e,o)),n})},e.prototype.makeProgress=function(t,e){return this.vNode.make("div",{key:"div3"+e,class:{"fc-files":!0}},[this.vNode.progress({key:"upp"+e,props:{percent:t.percentage,hideInfo:!0},style:{width:"90%"}})])},e.prototype.makeUploadBtn=function(t,e){return this.vNode.upload(this.propsData,!0===e?[this.vNode.make("div",{key:"div5"+t,class:{"fc-upload-btn":!0}},[this.vNode.icon({key:"upi"+t,props:{type:"file"===this.handler.rule.props.uploadType?"ios-cloud-upload-outline":dt.imgUpIcon,size:20}})])]:[])},e.prototype.makeRemoveIcon=function(t,e,o){var r=this;return this.vNode.icon({key:"upri"+e+o,props:{type:"ios-trash-outline"},nativeOn:{click:function(){var t=r.handler.el.fileList,e=t[o];t.splice(o,1),r.onRemove(e,t)}}})},e.prototype.makeHandleIcon=function(t,e,o){var r=this;return this.vNode.icon({key:"uphi"+e+o,props:{type:u(this.uploadOptions.handleIcon)},nativeOn:{click:function(){r.onHandle(t)}}})},e}(C),K={image:["image",0],file:["file",0],uploadFileOne:["file",1],uploadImageOne:["image",1]},Q=Object.keys(K).reduce(function(t,e){return t[e]=j("upload",function(t){return t.props({uploadType:K[e][0],maxLength:K[e][1]})}),t},{});Q.uploadImage=Q.image,Q.uploadFile=Q.file;var X={handler:Y,render:Z,maker:Q,name:"upload"},tt={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this.rule;t.props.data||n(t.props,"data",[]),Array.isArray(this.rule.value)||n(t,"value",[])},e.prototype.toFormValue=function(t){return Array.isArray(t)?t:[]},e.prototype.mounted=function(){t.prototype.mounted.call(this),this.vm._changeFormData(this.field,this.toFormValue(this.el.value))},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){return[this.vNode.cascader(this.inputProps().get())]},e}(C),name:"cascader"},et={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toFormValue=function(t){var e=parseFloat(t);return Number.isNaN(e)&&(e=0),e},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){return[this.vNode.rate(this.inputProps().get())]},e}(C),name:"rate"},ot={handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this.rule;n(t.props,"min",void 0===t.props.min?0:parseFloat(t.props.min)||0)},e.prototype.toFormValue=function(t){var e=this.rule,o=Array.isArray(t),r=e.props,n=r.min;return!0===r.range?o?t:[n,parseFloat(t)||n]:o?parseFloat(t[0])||n:parseFloat(t)},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){return[this.vNode.slider(this.inputProps().get())]},e}(C),name:"slider",maker:{sliderRange:j("slider",!0,"range")}};var rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t,e;t=this.rule,(e=t.props).type||n(e,"type","input"),e.icon||n(e,"icon",dt.fileUpIcon),e.width||n(e,"width","500px"),e.height||n(e,"height","370px"),s(e.spin)&&n(e,"spin",!0),e.title||n(e,"title","请选择"+t.title),e.maxLength||n(e,"maxLength",0),e.handleIcon,n(e,"handleIcon",("file"!==e.type||void 0!==e.handleIcon)&&(!0===e.handleIcon||void 0===e.handleIcon?"ios-eye-outline":e.handleIcon)),void 0===e.allowRemove&&n(e,"allowRemove",!0),this.multiple=1!=this.rule.props.maxLength},e.prototype.toFormValue=function(t){var e,o=t,r=Array.isArray(o);return e=""===o?[]:r?o:[o],this.parseValue=e,e},e.prototype.toValue=function(t){return!0===this.multiple?t:void 0===t[0]?"":t[0]},e.prototype.watchValue=function(e){t.prototype.watchValue.call(this,e),this.render.onChange(e),this.render.sync()},e.prototype.watchFormValue=function(e){t.prototype.watchFormValue.call(this,e),this.parseValue=e,this.render.sync()},e}(k),nt={onOpen:"on-open",onChange:"on-change",onCancel:"on-cancel",onOk:"on-ok"},it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){this._props=this.handler.rule.props,this.issetIcon=!1!==this._props.handleIcon||!0===this._props.allowRemove},e.prototype.parse=function(){var t=this._props.type;return"image"===t?this.makeGroup(this.makeImage()):"file"===t?this.makeGroup(this.makeFile()):this.makeInput()},e.prototype.makeInput=function(t){var e=this,o=this.handler.unique,r=this.inputProps().props({type:"text",value:this.handler.parseValue.toString(),icon:this._props.icon,readonly:!0,clearable:!0}).on("on-click",function(){e.showModel()}).key("ifit"+o).style({display:!0===t?"none":"inline-block"}).get();return[this.vNode.input(r)]},e.prototype.makeGroup=function(t){var e=this.handler.unique,o=this.handler.field;return[this.vNode.make("div",{key:"ifgp1"+e,class:{"fc-upload fc-frame":!0},ref:this.handler.refName,props:{value:this.vm._formData(o)}},t),this.makeInput(!0)]},e.prototype.makeImage=function(){var t=this,e=this.handler.unique,o=this.handler.parseValue.map(function(o,r){return t.vNode.make("div",{key:"ifid1"+e+r,class:{"fc-files":!0}},[t.vNode.make("img",{key:"ifim"+e+r,attrs:{src:o}}),t.makeIcons(o,e,r)])});return o.push(this.makeBtn()),o},e.prototype.makeFile=function(){var t=this,e=this.handler.unique,o=this.handler.parseValue.map(function(o,r){return t.vNode.make("div",{key:"iffd2"+e+r,class:{"fc-files":!0}},[t.vNode.icon({key:"iff"+e+r,props:{type:dt.fileIcon,size:40}}),t.makeIcons(o,e,r)])});return o.push(this.makeBtn()),o},e.prototype.makeBtn=function(){var t=this,e=this.handler.rule.props;if(!(e.maxLength>0&&this.handler.parseValue.length>=e.maxLength)){var o=this.handler.unique;return this.vNode.make("div",{key:"ifbd3"+o,class:{"fc-upload-btn":!0},on:{click:function(){t.showModel()}}},[this.vNode.icon({key:"ifbi3"+o,props:{type:this._props.icon,size:20}})])}},e.prototype.makeSpin=function(){if(!0===this._props.spin){var t=this.handler.unique;return this.vNode.make("Spin",{props:{fix:!0},key:"ifsp"+t,class:{"fc-spin":!0}},[this.vNode.icon({props:{type:"load-c",size:18},class:{"fc-spin-icon-load":!0},key:"ifspi"+t}),this.vNode.make("div",{domProps:{innerHTML:"加载中..."},key:"ifspd"+t})])}},e.prototype.makeIcons=function(t,e,o){var r=this;if(!0===this.issetIcon)return this.vNode.make("div",{key:"ifis"+e+o,class:{"fc-upload-cover":!0}},function(){var n=[];return!1!==r._props.handleIcon&&n.push(r.makeHandleIcon(t,e,o)),!0===r._props.allowRemove&&n.push(r.makeRemoveIcon(t,e,o)),n})},e.prototype.makeRemoveIcon=function(t,e,o){var r=this;return this.vNode.icon({key:"ifri"+e+o,props:{type:"ios-trash-outline"},nativeOn:{click:function(){!1!==r.onRemove(t)&&(r.handler.parseValue.splice(o,1),r.sync())}}})},e.prototype.makeHandleIcon=function(t,e,o){var r=this,n=this._props;return this.vNode.icon({key:"ifhi"+e+o,props:{type:toString(n.handleIcon)},nativeOn:{click:function(){r.onHandle(t)}}})},e.prototype.onRemove=function(t){var e=this.handler.rule.event["on-remove"];if(e)return e(t,this.handler.getValue())},e.prototype.onHandle=function(t){var e=this.handler.rule.event["on-handle"];if(e)return e(t);this.defaultOnHandle(t)},e.prototype.valid=function(t){if(t!==this.handler.field)throw new Error("无效的表单字段\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com")},e.prototype.showModel=function(){var t=this,e=!1!==this.onOpen(),r=this._props,n=r.width,i=r.height,a=r.src,s=r.title;e&&(this.vm.$Modal.remove(),setTimeout(function(){t.vm.$Modal.confirm({title:s,render:function(){return[t.makeSpin(),t.vNode.make("iframe",{attrs:{src:a},style:{height:i,border:"0 none",width:"100%"},on:{load:function(e){if(!0===t._props.spin){var r=document.getElementsByClassName("fc-spin")[0];r&&r.parentNode.removeChild(r)}try{if(!0===t.options.iframeHelper){var n=e.path[0].contentWindow;n[t.handler.field+"_change"]=function(e){t.handler.setValue(e)},n.form_create_helper={close:function(e){t.valid(e),o.Modal.remove()},set:function(e,o){t.valid(e),n[e+"_change"](o)},get:function(e){return t.valid(e),t.handler.rule.value}}}}catch(e){}}},key:"ifmd"+b()})]},onOk:function(){return t.onOk()},onCancel:function(){return t.onCancel()},showCancel:!0,closable:!0,scrollable:!0,width:n})},301))},e}(C);it.prototype.defaultOnHandle=X.render.prototype.defaultOnHandle,Object.keys(nt).forEach(function(t){it.prototype[t]=function(){var e=this.handler.rule.event[nt[t]];if(e)return e(this.handler.getValue())}});var at={frameInputs:["input",0],frameFiles:["file",0],frameImages:["image",0],frameInputOne:["input",1],frameFileOne:["file",1],frameImageOne:["image",1]},st=Object.keys(at).reduce(function(t,e){return t[e]=j("frame",function(t){return t.props({type:at[e][0],maxLength:at[e][1]})}),t},{});st.frameInput=st.frameInputs,st.frameFile=st.frameFiles,st.frameImage=st.frameImages;var ut="on-select-change",pt="on-check-change",ct={treeSelected:"selected",treeChecked:"checked"},lt={hidden:A,input:q,radio:B,checkbox:L,switch:T,select:H,datepicker:M,timepicker:z,inputnumber:G,colorpicker:W,upload:X,cascader:tt,rate:et,slider:ot,frame:{handler:rt,render:it,name:"frame",maker:st},tree:{handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t,e;t=this.rule,void 0===(e=t.props).data&&n(e,"data",[]),void 0===e.type&&n(e,"type","checked"),void 0===e.multiple&&n(e,"multiple",!1),this._data={},this.data(this.rule.props.data),n(this.rule,"value",this._parseValue())},e.prototype._parseValue=function(){var t=this;this.rule.value.forEach("selected"===this.rule.props.type?function(e){return t.selected(e)}:function(e){return t.checked(e)});var e=[];return"selected"===this.rule.props.type?Object.keys(this._data).forEach(function(o){var r=t._data[o];!0===r.selected&&e.push(r.id)}):Object.keys(this._data).forEach(function(o){var r=t._data[o];!0===r.checked&&e.push(r.id)}),e},e.prototype.toFormValue=function(t){return t=y(t),this.choose(t),this.parseValue=t,t},e.prototype.choose=function(t){var e=this.rule,o=this._data;"selected"===e.props.type?Object.keys(o).forEach(function(e){n(o[e],"selected",-1!==t.indexOf(o[e].id))}):Object.keys(o).forEach(function(e){n(o[e],"checked",-1!==t.indexOf(o[e].id))})},e.prototype.checked=function(t){void 0!==this._data[t]&&n(this._data[t],"checked",!0)},e.prototype.selected=function(t){void 0!==this._data[t]&&n(this._data[t],"selected",!0)},e.prototype.toValue=function(t){var e,o=t;return(e=this.rule).props.multiple||"selected"!==e.props.type?o:o[0]||""},e.prototype.watchFormValue=function(t){this.choose(t)},e.prototype.selectedValue=function(t){var e=[];return t.forEach(function(t){!0===t.selected&&e.push(t.id)}),e},e.prototype.checkedValue=function(t){var e=[];return t.forEach(function(t){!0===t.checked&&e.push(t.id)}),e},e.prototype._toValue=function(){return"selected"===this.rule.props.type?this.selectedValue(this.el.getSelectedNodes()):this.checkedValue(this.el.getCheckedNodes())},e.prototype.data=function(t){var e=this;t.forEach(function(t){e._data[t.id]=t,void 0!==t.children&&Array.isArray(t.children)&&e.data(t.children)})},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){var t,e=this,o=this.handler,r=o.rule,n=o.refName,i=o.field,a=o.unique,s=this.vData.on(r.event).on((t={},t[ut]=function(t){e.vm._changeFormData(i,e.handler._toValue()),r.event[ut]&&r.event[ut](t)},t[pt]=function(t){e.vm._changeFormData(i,e.handler._toValue()),r.event[pt]&&r.event[pt](t)},t)).props(r.props).ref(n).key("fip"+a).get(),u=this.inputProps().props({type:"text",value:this.handler.parseValue.toString(),disable:!0}).key("fipit"+a).style({display:"none"}).ref(n+"it").get();return[this.vNode.tree(s),this.vNode.input(u)]},e}(C),name:"tree",maker:Object.keys(ct).reduce(function(t,e){return t[e]=j("tree",ct[e]),t},{})},autocomplete:{handler:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this.rule;Array.isArray(t.data)||n(t,"data",[])},e}(k),render:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse=function(){return[this.vNode.AutoComplete(this.inputProps().key(this.handler.key).get())]},e}(C),name:"autoComplete",maker:{auto:I("autoComplete")}}},ht={_v:2,resetBtnType:"ghost",resetBtnIcon:"refresh",submitBtnIcon:"ios-upload",fileIcon:"document-text",fileUpIcon:"folder",imgUpIcon:"image"},ft={_v:3,resetBtnType:"default",resetBtnIcon:"md-refresh",submitBtnIcon:"ios-share",fileIcon:"md-document",fileUpIcon:"ios-folder-open",imgUpIcon:"md-images"},dt=void 0===o?ht:o.version&&3==o.version.split(".")[0]?ft:ht;function mt(t,e,o){var r=u(e.type).toLowerCase(),n=yt(r)?lt[r]:{handler:k,render:C,noValue:!0};return new n.handler(t,e,n.render,o,n.noValue)}function yt(t){return void 0!==lt[t]}var vt=".form-create{padding:25px;} .fc-upload-btn,.fc-files{display: inline-block;width: 58px;height: 58px;text-align: center;line-height: 58px;border: 1px solid #c0ccda;border-radius: 4px;overflow: hidden;background: #fff;position: relative;box-shadow: 2px 2px 5px rgba(0,0,0,.1);margin-right: 4px;box-sizing: border-box;}.__fc_h{display:none;}.__fc_v{visibility:hidden;} .fc-files>.ivu-icon{vertical-align: middle;}.fc-files img{width:100%;height:100%;display:inline-block;vertical-align: top;}.fc-upload .ivu-upload{display: inline-block;}.fc-upload-btn{border: 1px dashed #c0ccda;}.fc-upload-btn>ivu-icon{vertical-align:sub;}.fc-upload .fc-upload-cover{opacity: 0; position: absolute; top: 0; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,.6); transition: opacity .3s;}.fc-upload .fc-upload-cover i{ color: #fff; font-size: 20px; cursor: pointer; margin: 0 2px; }.fc-files:hover .fc-upload-cover{opacity: 1; }.fc-hide-btn .ivu-upload .ivu-upload{display:none;}.fc-upload .ivu-upload-list{margin-top: 0;}.fc-spin-icon-load{animation: ani-fc-spin 1s linear infinite;} @-webkit-keyframes ani-fc-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}50%{-webkit-transform:rotate(180deg);transform:rotate(180deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes ani-fc-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}50%{-webkit-transform:rotate(180deg);transform:rotate(180deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}";function _t(t,e,o){return[t&&h(t)?t.call(o,e):t]}function gt(t){if(c(t))return t;var e=new Date(t);return"Invalid Date"===e.toString()?t:e}var bt={data:function(){return{rules:{},components:{},cptData:{},buttonProps:{},resetProps:{},trueData:{},jsonData:{},$f:{},isShow:!0,watchs:[],unique:1}},methods:{_formField:function(){return Object.keys(this.trueData)},_changeFormData:function(t,e){-1!==Object.keys(this.cptData).indexOf(t)&&this.$set(this.cptData,t,e)},_changeValue:function(t,e){this.$set(this.trueData[t],"value",e)},_value:function(t){return void 0===this.trueData[t]?void 0:this.trueData[t].value},_trueData:function(t){return this.trueData[t]},_formData:function(t){return this.cptData[t]},_removeField:function(t){i(this.cptData,t),i(this.trueData,t),i(this.jsonData,t),void 0!==this.components[t]&&i(this.components,t)},_buttonProps:function(t){this.$set(this,"buttonProps",_(this.buttonProps,t))},_resetProps:function(t){this.$set(this,"resetProps",_(this.resetProps,t))},__init:function(){var t=this,e=this._fComponent._type;this[e].forEach(function(o,r){var n=t.$watch(e+"."+r+".value",function(e){if(void 0===t.trueData[o.field])return n();t._changeValue(o.field,e)});t.watchs.push(n)})},_unWatch:function(){this.watchs.forEach(function(t){return t()}),this.watchs=[]},_refresh:function(){this.unique+=1},_sync:function(){this.unique+=1,this._fComponent.fRender.cacheUnique=this.unique},_change:function(t,e){return this.jsonData[t]!==e&&(this.jsonData[t]=e,!0)}}};function kt(t){t.preventDefault()}var wt=function(t){var e=t.vm,o=t.options,r=t.fieldList,n=t.handlers,i=t.formData,a=t.validate,s=t.fCreateApi;this.vm=e,this.options=o,this.handlers=n,this.renderSort=r,this.form={model:i,rules:a,key:"form"+b()},this.fCreateApi=s,this.vNode=new N(e),this.vData=new P,this.unique=b(),this.refName="cForm"+this.unique,this.cacheUnique=0};wt.prototype.getRender=function(t){return this.handlers[t].render},wt.prototype.render=function(t){var e=this;if(this.vNode.setVm(t),t.isShow){this.cacheUnique!==t.unique&&(this.renderSort.forEach(function(t){e.getRender(t).clearCache()}),this.cacheUnique=t.unique),this.propsData=this.vData.props(this.options.form).props(this.form).ref(this.refName).nativeOn({submit:kt}).class("form-create",!0).key(this.unique).get();var o=this.unique,r=this.renderSort.map(function(t){var o=e.getRender(t);if("hidden"!==o.handler.type)return e.makeComponent(o)});return r.length>0&&r.push(this.makeFormBtn(o)),this.vNode.form(this.propsData,[this.vNode.row(p({props:this.options.row||{}},{key:"row"+o}),r)])}},wt.prototype.makeComponent=function(t){return this.makeFormItem(t.handler,t.cacheParse(this),"fItem"+t.handler.key+this.unique)},wt.prototype.makeFormItem=function(t,e,o){var r=t.type,n=t.rule,i=t.unique,a=t.field,s=t.refName,u=yt(r)||n.col.labelWidth||n.title?n.col.labelWidth:1,p=n.className,c=this.vData.props({prop:a,label:n.title,labelFor:i,rules:n.validate,labelWidth:u,required:n.props.required}).key(o).ref("fItem"+s).class(p).get(),l=this.vNode.formItem(c,e);return!0===this.propsData.props.inline?[l]:this.makeCol(n,o,[l])},wt.prototype.makeCol=function(t,e,o){return this.vNode.col({props:t.col,class:{__fc_h:!0===t.props.hidden,__fc_v:!0===t.props.visibility},key:e+"col1"},o)},wt.prototype.makeFormBtn=function(t){var e=[],o=!1!==this.vm.buttonProps&&!1!==this.vm.buttonProps.show,r=!1!==this.vm.resetProps&&!1!==this.vm.resetProps.show;return o&&e.push(this.makeSubmitBtn(t,r?19:24)),r&&e.push(this.makeResetBtn(t,4)),this.vNode.col({props:{span:24},key:this.unique+"col2"},e)},wt.prototype.makeResetBtn=function(t,e){var o=this,r=s(this.options.resetBtn.col)?{span:e,push:1}:this.options.resetBtn.col;return this.vNode.col({props:r,key:this.unique+"col3"},[this.vNode.button({key:"frsbtn"+t,props:this.vm.resetProps,on:{click:function(){o.fCreateApi.resetFields()}}},[this.vm.resetProps.innerText])])},wt.prototype.makeSubmitBtn=function(t,e){var o=this,r=s(this.options.submitBtn.col)?{span:e}:this.options.submitBtn.col;return this.vNode.col({props:r,key:this.unique+"col4"},[this.vNode.button({key:"fbtn"+t,props:this.vm.buttonProps,on:{click:function(){o.fCreateApi.submit()}}},[this.vm.buttonProps.innerText])])};var Ot="FormCreate";var Vt=function(){var t={};Object.keys(lt).forEach(function(e){var o=lt[e],r=s(o.maker);(r||void 0===o.maker[o.name])&&(t[o.name]=I(o.name)),r||p(t,o.maker)});var e=I("");return p(t,{create:function(t,o){var r=e("",o);return r.rule.type=t,r},createTmp:function(t,o,r){var n=e("",r);return n.rule.type="template",n.rule.template=t,n.rule.vm=o,n}}),t.template=t.createTmp,t}(),xt="form-create-style";function Nt(t){d(t.sumbitBtn)&&n(t,"sumbitBtn",{show:t.sumbitBtn}),d(t.resetBtn)&&n(t,"resetBtn",{show:t.resetBtn});var e=_({el:null,iframeHelper:!1,switchMaker:!0,form:{inline:!1,labelPosition:"right",labelWidth:125,showMessage:!0,autocomplete:"off",size:void 0},row:{gutter:0,type:void 0,align:void 0,justify:void 0,className:void 0},upload:{beforeUpload:function(){},onProgress:function(t,e,o){},onSuccess:function(t,e,o){},onError:function(t,e,o){},onPreview:function(t){},onRemove:function(t,e){},onFormatError:function(t,e){},onExceededSize:function(t,e){},handleIcon:"ios-eye-outline",allowRemove:!0},submitBtn:{type:"primary",size:"large",shape:void 0,long:!0,htmlType:"button",disabled:!1,icon:dt.submitBtnIcon,innerText:"提交",loading:!1,show:!0,col:void 0},resetBtn:{type:dt.resetBtnType,size:"large",shape:void 0,long:!0,htmlType:"button",disabled:!1,icon:dt.resetBtnIcon,innerText:"重置",loading:!1,show:!1,col:void 0},mounted:function(t){},onReload:function(t){},onSubmit:function(t){}},t);return n(e,"el",e.el?v(e.el)?e.el:document.querySelector(e.el):window.document.body),e}var Ft=function(t,e){var o,r,n;void 0===e&&(e={}),this.options=Nt(e),this.rules=Array.isArray(t)?t:[],this.origin=[].concat(this.rules),this.handlers={},this.fRender={},this.formData={},this.validate={},this.trueData={},this.components={},this.fieldList=[],this.switchMaker=this.options.switchMaker,this.id=b(),function(){if(null===document.getElementById(xt)){var t=document.createElement("style");t.id=xt,t.innerText=vt,document.getElementsByTagName("head")[0].appendChild(t)}}(),this.$tick=(o=function(t){return t()},r=150,n=null,function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];null!==n&&clearTimeout(n),n=setTimeout(function(){return o.apply(void 0,t)},r)})};function Pt(t){!0!==t._installedFormCreate&&(t._installedFormCreate=!0,t.use(Ft))}Ft.create=function(t,o,r){void 0===o&&(o={}),void 0===r&&(r=e);var n=v(o)?{el:o}:o,i=new Ft(t,n);i.create(r);return i.fCreateApi},Ft.install=function(t){t.prototype.$formCreate=function(e,o){return void 0===o&&(o={}),Ft.create(e,o,t)},t.prototype.$formCreate.version="1.5.4",t.prototype.$formCreate.maker=Vt,t.component(Ot,t.extend({name:Ot,props:{rule:{type:Array,required:!0,default:function(){return{}}},option:{type:Object,default:function(){return{}},required:!1},value:Object},data:bt.data,methods:bt.methods,render:function(){return this._fComponent.fRender.render(this._fComponent.vm)},created:function(){this._fComponent=new Ft(this.rule,this.option),this._fComponent._type="rule",this._fComponent.init(this),this.$emit("input",this._fComponent.fCreateApi)},mounted:function(){var t=this;this._fComponent.mounted(this),this.$f=this._fComponent.fCreateApi,this.$watch("rule",function(e){t._fComponent.reload(e),t.$emit("input",t.$f)}),this.$emit("input",this.$f),this.__init()}}))},Ft.prototype.init=function(t){this.vm=t,this.createHandler(this.rules),t.$set(t,"cptData",this.formData),t.$set(t,"trueData",this.trueData),t.$set(t,"buttonProps",this.options.submitBtn),t.$set(t,"resetProps",this.options.resetBtn),t.$set(t,"rules",this.rules),t.$set(t,"components",this.components),void 0===this.fCreateApi&&(this.fCreateApi=function(t){var e=this,o=t.vm;return{formData:function(){return o._formField().reduce(function(t,e){return t[e]=o._value(e),t},{})},getValue:function(t){if(t=u(t),void 0===o._formField(t))throw new Error(t+" 字段不存在!\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");return o._value(t)},changeValue:function(t,e){this.changeField(t,e)},changeField:function(r,n){r=u(r);var i=t.handlers[r];if(void 0===i)throw new Error(r+" 字段不存在!\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");h(n)?n(o._trueData(r),function(t){e.changeField(r,t)}):i.setValue(n)},removeField:function(e){var r=t.handlers[e];if(!r)throw new Error(e+" 字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");var n=r.root.map(function(t){return t.__field__}).indexOf(u(e));if(-1===n)throw new Error(e+" 字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");r.root.splice(n,1),o._refresh()},validate:function(e,o){t.getFormRef().validate(function(t){!0===t?e&&e():o&&o()})},validateField:function(e,o){if(t.notField(e))throw new Error(e+"字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");t.getFormRef().validateField(e,o)},resetFields:function(){var e=t.handlers;o._formField().forEach(function(t){e[t].reset()}),this.refresh()},destroy:function(){o.$el.parentNode.removeChild(o.$el),o.$destroy()},fields:function(){return o._formField()},append:function(e,o){var r=t.fieldList,n=r.indexOf(u(o));if(s(o))n=r.length;else if(-1===n)throw new Error(o+" 字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");t.rules.splice(n,0,e)},prepend:function(e,o){var r=t.fieldList.indexOf(u(o));if(s(o))r=0;else{if(-1===r)throw new Error(o+" 字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");r--}t.rules.splice(r,0,e)},submit:function(e,o){var r=this;this.validate(function(){var o=r.formData();h(e)?e(o):t.options.onSubmit&&t.options.onSubmit(o)},function(){return o&&o()})},hidden:function(t,e){void 0===e&&(e=!0),t?Array.isArray(t)||(t=[t]):t=this.fields(),t.forEach(function(t){o.$set(o._trueData(t).rule.props,"hidden",!!e)})},visibility:function(t,e){void 0===e&&(e=!0),t?Array.isArray(t)||(t=[t]):t=this.fields(),t.forEach(function(t){o.$set(o._trueData(t).rule.props,"visibility",!!e)})},model:function(t){var e={},r=this.fields();return t?Array.isArray(t)||(t=[t]):t=r,t.forEach(function(t){if(-1===r.indexOf(t))return console.error(t+"字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");e[t]=o._trueData(t)}),e},component:function(){return Object.assign({},o.components)},bind:function(t){var e={},r={},n=this.fields();return t?Array.isArray(t)||(t=[t]):t=n,t.forEach(function(t){if(-1===n.indexOf(t))return console.error(t+"字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");var e=o._trueData(t);r[t]={get:function(){return e.value},set:function(t){o.$set(e,"value",t)},enumerable:!0,configurable:!0}}),Object.defineProperties(e,r),e},submitStatus:function(t){void 0===t&&(t={}),o._buttonProps(t)},resetStatus:function(t){void 0===t&&(t={}),o._resetProps(t)},btn:{loading:function(t){void 0===t&&(t=!0),o._buttonProps({loading:t})},finish:function(){this.loading(!1)},disabled:function(t){void 0===t&&(t=!0),o._buttonProps({disabled:t})}},resetBtn:{loading:function(t){void 0===t&&(t=!0),o._resetProps({loading:t})},finish:function(){this.loading(!1)},disabled:function(t){void 0===t&&(t=!0),o._resetProps({disabled:t})}},closeModal:function(){o.$Modal.remove()},set:function(t,e,r){o.$set(t,e,r)},reload:function(e){return t.reload(e)},options:function(e){_(t.options,e),o._sync()},onSuccess:function(t){this.onSubmit(t)},onSubmit:function(t){this.options({onSubmit:t})},sync:function(e,o){if(!t.handlers[e])throw new Error(e+"字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");t.handlers[e].render.sync(o)},refresh:function(){o._refresh()}}}(this)),this.fCreateApi.rule=this.rules,this.fRender=new wt(this)},Ft.prototype.setHandler=function(t){var e=t.rule,o=t.field,r=t.isDef;this.handlers[o]=t,!0!==t.noValue?(n(this.formData,o,t.parseValue),n(this.validate,o,e.validate),n(this.trueData,o,{value:t.rule.value,rule:e})):!0===r&&n(this.components,o,e)},Ft.prototype.notField=function(t){return void 0===this.handlers[t]},Ft.prototype.createHandler=function(t,e){var o=this;t.forEach(function(r,n){if(!e||!f(r)){if(!r.type)return console.error("未定义生成规则的 type\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");var i=function(t){return h(t.getRule)?t.getRule():t}(r),a=r.__handler__?r.__handler__.refresh():mt(o.vm,i,o.options),s=a.rule.children;if(!o.notField(a.field))return console.error(i.field+" 字段已存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");o.switchMaker&&(t[n]=i,e||(o.origin[n]=i),r=i),o.setHandler(a),r.__handler__||function(t,e){Object.defineProperties(t,{__field__:{value:e.field,enumerable:!1,configurable:!1},__handler__:{value:e,enumerable:!1,configurable:!1}})}(r,a),Array.isArray(s)&&s.length>0&&o.createHandler(s,!0),e||o.fieldList.push(a.field)}}),t.forEach(function(e){e.__handler__.root=t,e.__handler__.origin=[].concat(t)})},Ft.prototype.create=function(t){var e=(new(t.extend(this.component()))).$mount();return this.options.el.appendChild(e.$el),e},Ft.prototype.mounted=function(t,e){var o=this;void 0===e&&(e=!0),this.vm=t;var n=this.options,i=n.mounted,a=n.onReload;setTimeout(function(){r(function(){Object.keys(o.handlers).forEach(function(e){var r=o.handlers[e];void 0!==t._formData(e)&&o.addHandlerWatch(r),r.mounted()}),e&&i&&i(o.fCreateApi),a&&a(o.fCreateApi)})})},Ft.prototype.component=function(){return t=this,{name:Ot+"Core",data:bt.data,render:function(){return t.fRender.render(t.vm)},methods:bt.methods,created:function(){this._fComponent=t,this._fComponent._type="rules",t.init(this)},mounted:function(){var e=this;t.mounted(this),this.$f=t.fCreateApi,this.__init(),this.$watch("rules",function(t){e._fComponent.reload(t)})}};var t},Ft.prototype.removeField=function(t){if(void 0===this.handlers[t])throw new Error(t+"字段不存在\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com");var e=this.handlers[t].watch,o=this.fieldList.indexOf(t);i(this.handlers,t),i(this.validate,t),-1!==o&&this.fieldList.splice(o,1),e&&e.forEach(function(t){return t()}),this.vm._removeField(t)},Ft.prototype.addHandlerWatch=function(t){var e=this;if(!0!==t.noValue){var o=t.field,n=this.vm,i=n.$watch("cptData."+o,function(r){if(void 0!==e.handlers[o]){var a=t.toValue(r),s=JSON.stringify(a);n._change(o,s)&&(t.setValue(a),t.watchFormValue(r))}else i()},{deep:!0}),a=n.$watch("trueData."+o+".value",function(i){if(void 0!==i)if(void 0!==e.handlers[o]){var s=JSON.stringify(i);n._change(o,s)&&(t.watchValue(i),r(function(){return t.render.sync()}))}else a()},{deep:!0});t.watch.push(i,a);var s=function(){void 0!==e.handlers[o]&&e.$tick(function(){return t.render.sync()})};Object.keys(n._trueData(o).rule).forEach(function(e){"value"!==e&&t.watch.push(n.$watch("trueData."+o+".rule."+e,s,{deep:!0}))})}},Ft.prototype.isNotChange=function(t){var e=this;return t.reduce(function(t,o,r){return t&&o===e.origin[r]},!0)&&this.origin.reduce(function(e,o,r){return e&&o===t[r]},!0)},Ft.prototype.reload=function(t){var e=this,o=this.vm;if(t){if(this.isNotChange(t))return void this.fCreateApi.refresh();this.origin.length||this.fCreateApi.refresh(),this.origin=[].concat(t),o._unWatch(),Object.keys(this.handlers).forEach(function(t){return e.removeField(t)}),this.constructor(t,this.options),this.init(o),o.__init(),r(function(){e.mounted(o,!1)})}else this.reload(this.rules);o.$f=this.fCreateApi},Ft.prototype.getFormRef=function(){return this.vm.$refs[this.fRender.refName]},Ft.maker=Vt,Ft.version="1.5.4","undefined"!=typeof window&&window.Vue&&Pt(Vue);var Ct=window.formCreate=Ft;t.install=Pt,t.default=Ct,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=form-create.min.js.map
