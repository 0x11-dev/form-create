/*!
 * @form-create/iview v2.0.0-bata.1
 * (c) 2018-2019 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("iview"),require("vue")):"function"==typeof define&&define.amd?define(["exports","iview","vue"],t):t((e=e||self).formCreate={},e.iview,e.Vue)}(this,function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){s(e,t,n[t])})}return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(){return(p=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;var v=["attrs","props","domProps"],m=["class","style","directives"],y=["on","nativeOn"],g=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}},b=function(e){return e.reduce(function(e,t){for(var n in t)if(e[n])if(-1!==v.indexOf(n))e[n]=p({},e[n],t[n]);else if(-1!==m.indexOf(n)){var i=e[n]instanceof Array?e[n]:[e[n]],r=t[n]instanceof Array?t[n]:[t[n]];e[n]=i.concat(r)}else if(-1!==y.indexOf(n))for(var o in t[n])if(e[n][o]){var a=e[n][o]instanceof Array?e[n][o]:[e[n][o]],s=t[n][o]instanceof Array?t[n][o]:[t[n][o]];e[n][o]=a.concat(s)}else e[n][o]=t[n][o];else if("hook"==n)for(var u in t[n])e[n][u]=e[n][u]?g(e[n][u],t[n][u]):t[n][u];else e[n]=t[n];else e[n]=t[n];return e},{})};var k=function(e,t,n,i,r,o,a,s,u,l){"boolean"!=typeof a&&(u=s,s=a,a=!1);var c,f="function"==typeof n?n.options:n;if(e&&e.render&&(f.render=e.render,f.staticRenderFns=e.staticRenderFns,f._compiled=!0,r&&(f.functional=!0)),i&&(f._scopeId=i),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,u(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},f._ssrRegister=c):t&&(c=a?function(){t.call(this,l(this.$root.$options.shadowRoot))}:function(e){t.call(this,s(e))}),c)if(f.functional){var h=f.render;f.render=function(e,t){return c.call(t),h(e,t)}}else{var d=f.beforeCreate;f.beforeCreate=d?[].concat(d,c):[c]}return n},$=k({},void 0,{name:"fc-checkbox",props:{options:{type:Array,default:function(){return[]}},children:{type:Array,default:function(){return[]}},ctx:{type:Object,default:function(){return{}}},value:{type:Array,default:function(){return[]}}},watch:{value:function(){this.update()}},data:function(){return{trueValue:[]}},methods:{onInput:function(e){this.$emit("input",this.options.filter(function(t){return-1!==e.indexOf(t.label)}).map(function(e){return e.value}))},update:function(){var e=this;this.trueValue=this.options.filter(function(t){return-1!==e.value.indexOf(t.value)}).map(function(e){return e.label})}},created:function(){this.update()},render:function(){var e=this,t=arguments[0];return t("CheckboxGroup",b([{},this.ctx,{on:{input:this.onInput},model:{value:e.trueValue,callback:function(t){e.trueValue=t}}}]),[this.options.map(function(e){var n=u({},e);return delete n.value,t("Checkbox",{props:u({},n)})}).concat(this.chlidren)])}},void 0,void 0,void 0,void 0,void 0),w={_v:2,resetBtnType:"ghost",resetBtnIcon:"refresh",submitBtnIcon:"ios-upload",fileIcon:"document-text",fileUpIcon:"folder",imgUpIcon:"image"},_={_v:3,resetBtnType:"default",resetBtnIcon:"md-refresh",submitBtnIcon:"ios-share",fileIcon:"md-document",fileUpIcon:"ios-folder-open",imgUpIcon:"md-images"},O=void 0===t?w:t.version&&3==t.version.split(".")[0]?_:w;function C(e){return(C="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),e}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function R(e,t,i){n.set(e,t,i)}function E(e,t){n.delete(e,t)}function F(e){return Array.isArray(e)&&e.length>0}var N=Object.prototype.toString;function T(e){return null==e}function V(e){return null==e?"":"object"===C(e)?JSON.stringify(e,null,2):String(e)}function B(e,t){for(var n in t)R(e,n,t[n]);return e}function q(e,t){return N.call(e)==="[object "+t+"]"}function M(e){return q(e,"Object")}function U(e){return q(e,"Function")}function z(e){return q(e,"String")}function G(e){return q(e,"Boolean")}function H(e){return"object"===C(e)&&null!==e&&1===e.nodeType&&!M(e)}function W(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!1;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=t[i];if((n=Array.isArray(r))||M(r)){var o=void 0===e[i];n?(n=!1,o&&R(e,i,[])):o&&R(e,i,{}),W(e[i],r)}else R(e,i,r)}return e}var J=0;function X(){return++J}function Y(e){return"\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com"+(e||"")}var Z="FormCreate";function K(e,t){return{name:Z,props:{rule:{type:Array,required:!0,default:function(){return{}}},option:{type:Object,default:function(){return{}},required:!1},value:Object},data:function(){return{formData:void 0,buttonProps:void 0,resetProps:void 0,$f:void 0,isShow:!0,unique:1}},components:t,render:function(){return this.formCreate.render()},methods:{_buttonProps:function(e){this.$set(this,"buttonProps",W(this.buttonProps,e))},_resetProps:function(e){this.$set(this,"resetProps",W(this.resetProps,e))},_refresh:function(){this.unique+=1}},watch:{option:"_refresh",rule:function(e){this.formCreate.handle.reloadRule(e)}},beforeCreate:function(){var t=this.$options.propsData,n=t.rule,i=t.option;this.formCreate=new e(n,i),this.formCreate.beforeCreate(this)},created:function(){this.formCreate.created(),this.$f=this.formCreate.api(),this.$emit("input",this.$f)},mounted:function(){this.formCreate.mounted(),this.$emit("input",this.$f)},beforeDestroy:function(){this.formCreate.handle.reloadRule([]),this.formCreate.handle.$render.clearCacheAll()}}}var Q=function(){function e(){x(this,e),this.init()}return A(e,[{key:"class",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return T(e)?this:(Array.isArray(e)?e.forEach(function(e){R(t._data.class,V(e),!0)}):M(e)?R(this._data,"class",B(this._data.class,e)):R(this._data.class,V(e),void 0===n||n),this)}},{key:"directives",value:function(e){return T(e)?this:(R(this._data,"directives",this._data.directives.concat((t=e,Array.isArray(t)?t:T(t)?[]:[t]))),this);var t}},{key:"init",value:function(){return this._data={class:{},style:{},attrs:{},props:{},domProps:{},on:{},nativeOn:{},directives:[],scopedSlots:{},slot:void 0,key:void 0,ref:void 0},this}},{key:"get",value:function(){var e=this,t=Object.keys(this._data).reduce(function(t,n){var i=e._data[n];return void 0===i?t:Array.isArray(i)&&!i.length?t:Object.keys(i).length?(t[n]=i,t):t},{});return this.init(),t}}]),e}();function ee(e){return function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new ne(e,t,n,i,r)}}function te(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"type";return function(i,r,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=new ne(e,i,r,o,a);return U(t)?t(s):s.props(n,t),s}}["ref","key","slot"].forEach(function(e){Q.prototype[e]=function(t){return R(this._data,e,t),this}}),["scopedSlots","nativeOn","on","domProps","props","attrs","style"].forEach(function(e){Q.prototype[e]=function(t,n){return T(t)?this:(M(t)?R(this._data,e,B(this._data[e],t)):R(this._data[e],V(t),n),this)}});var ne=function(e){function t(e,n,i,r){var o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return x(this,t),B((o=S(this,I(t).call(this)))._data,{validate:[],options:[],col:{},children:[],emit:[],template:void 0,emitPrefix:void 0}),B(o._data,{type:e,title:n,field:i,value:r}),M(a)&&o.props(a),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,Q),A(t,[{key:"type",value:function(e){return this.props("type",e),this}},{key:"getRule",value:function(){return this._data}},{key:"event",value:function(){return this.on.apply(this,arguments),this}}]),t}();["emitPrefix","className","defaultSlot","value","name","title"].forEach(function(e){ne.prototype[e]=function(t){return R(this._data,e,t),this}});["col"].forEach(function(e){ne.prototype[e]=function(t){return R(this._data,e,B(this._data[e],t)),this}});function ie(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(z(e)&&(e=JSON.parse(e)),e instanceof ne)return t?e:e.getRule();if(M(e)){var n=function(e){var t=new ne;return Object.keys(e).forEach(function(n){t._data[n]=e[n]}),t}(e);return t?n:n.getRule()}if(Array.isArray(e)){var i=e.map(function(e){return ie(e,t)});return Object.defineProperty(i,"find",{value:re,enumerable:!1,configurable:!1}),i}return e}function re(e){var t=[];for(var n in this){var i=this[n]instanceof ne?this[n].rule:this[n];if(i.field===e)return this[n];F(i.children)&&(t=t.concat(i.children))}if(t.length>0)return re.call(t,e)}["validate","options","children","emit"].forEach(function(e){ne.prototype[e]=function(t){return Array.isArray(t)||(t=[t]),R(this._data,e,this._data[e].concat(t)),this}});var oe,ae,se,ue=function(){function e(t){x(this,e),t&&this.setVm(t)}return A(e,[{key:"setVm",value:function(e){this.vm=e,this.$h=e.$createElement}},{key:"make",value:function(e,t,n){var i,r=this.$h(e,function(e){return z(e)?e={domProps:{innerHTML:e}}:e&&U(e.get)&&(e=e.get()),e}(t),U(i=n)?i():i||[]);return r.context=this.vm,r}}],[{key:"use",value:function(t){Object.keys(t).forEach(function(n){e.prototype[n]=function(e,i){return this.make(t[n],e,i)}})}}]),e}(),le=function(){function e(t,n,i){x(this,e),this.rule=n,this.vData=new Q,this.vNode=new ue,this.id=i,this.watch=[],this.type=V(n.type),this.isDef=!0,this.el=void 0,n.field?this.field=n.field:(this.field="_def_"+X(),this.isDef=!1),this.name=n.name,this.unique="fc_"+i,this.key="key_"+i,this.refName="__"+this.field+this.id,this.formItemRefName="fi"+this.refName,this.update(t),this.init()}return A(e,[{key:"update",value:function(e){this.$handle=e,this.$render=e.$render,this.vm=e.vm,this.options=e.options,this.vNode.setVm(this.vm),this.deleted=!1}},{key:"init",value:function(){}},{key:"toFormValue",value:function(e){return e}},{key:"toValue",value:function(e){return e}}]),e}(),ce=(oe=function(e){return e()},ae=1,se=null,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];null!==se&&clearTimeout(se),se=setTimeout(function(){return oe.apply(void 0,t)},ae)}),fe=function(){function e(t){x(this,e),this.$handle=t,this.fc=t.fc,this.vm=t.vm,this.options=t.options,this.form=t.$form,this.vNode=new ue(this.vm),this.vData=new Q,this.cache={},this.renderList={}}return A(e,[{key:"clearCache",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.cache[e.id]){this.cacheStatus(e)&&this.$handle.refresh();var n=this.cache[e.id].parent;this.cache[e.id]=null,n&&t&&this.clearCache(n,t)}}},{key:"clearCacheAll",value:function(){this.cache={}}},{key:"setCache",value:function(e,t,n){this.cache[e.id]={vnode:t,use:!1,parent:n}}},{key:"cacheStatus",value:function(e){return this.cache[e.id]&&(!0===this.cache[e.id].use||this.cache[e.id].parent)}},{key:"getCache",value:function(e){var t=this.cache[e.id];return t.use=!0,t.vnode}},{key:"initOrgChildren",value:function(){var e=this.$handle.parsers;this.orgChildren=Object.keys(e).reduce(function(t,n){var i=e[n].rule.children;return t[n]=F(i)?j(i):[],t},{})}},{key:"run",value:function(){var e=this;if(this.vm.isShow){this.form.beforeRender();var t=this.$handle.sortList.map(function(t){var n=e.$handle.parsers[t];if("hidden"!==n.type)return e.renderParser(n)}).filter(function(e){return void 0!==e});return this.form.render(t)}}},{key:"setGlobalConfig",value:function(e){this.options.global&&(this.options.global["*"]&&this.toData(e,this.options.global["*"]),this.options.global[e.type]&&this.toData(e,this.options.global[e.type]))}},{key:"renderTemplate",value:function(e){var t=this,n=e.id,i=e.rule,r=e.key;if(void 0===de.compile)return console.error("使用的 Vue 版本不支持 compile"+Y()),[];this.renderList[n]||(T(i.vm)&&(i.vm=new de),this.renderList[n]=de.compile(i.template)),function(e){var t=e.rule;if(!t.vm.$props)return;var n=Object.keys(t.vm.$props);n.forEach(function(e){void 0!==t.props[e]&&(t.vm.$props[e]=t.props[e])}),-1!==n.indexOf("value")&&(t.vm.$props.value=e.rule.value)}(e),i.vm.$off("input"),i.vm.$on("input",function(n){t.onInput(e,n)});var o=this.renderList[n].render.call(i.vm);return void 0===o.data&&(o.data={}),o.key=r,o}},{key:"renderParser",value:function(e,t){if(e.vData.get(),this.setGlobalConfig(e),!this.cache[e.id]||"template"===e.type){var n,i=e.type,r=e.rule,o=this.form;if("template"===i&&r.template){if(n=this.renderTemplate(e),t)return this.setCache(e,n,t),n}else if(this.$handle.isNoVal(e)){if(n=this.vNode.make(i,this.inputVData(e),this.renderChildren(e)),t)return this.setCache(e,n,t),n}else{var a=this.renderChildren(e);n=e.render?e.render(a):this.defaultRender(e,a)}var s=o.container(n,e);return this.setCache(e,s,t),s}return this.getCache(e)}},{key:"toData",value:function(e,t){return Object.keys(e.vData._data).forEach(function(n){void 0!==t[n]&&e.vData[n](t[n])}),e.vData}},{key:"parserToData",value:function(e){return this.toData(e,e.rule)}},{key:"inputVData",value:function(e,t){var n=this,i=e.refName,r=e.key,o=e.rule;this.parserToData(e);var a=e.vData.ref(i).key("fc_item"+r);return t||a.on("input",function(t){n.onInput(e,t)}).props("value",this.$handle.getFormData(e)),T(o.props.size)&&a.props("size",this.$handle.options.form.size),a}},{key:"onInput",value:function(e,t){this.$handle.onInput(e,t)}},{key:"renderChildren",value:function(e){var t=this,n=e.rule.children,i=this.orgChildren[e.id];return F(n)?(this.orgChildren[e.id].forEach(function(e){-1===n.indexOf(e)&&!z(e)&&e.__fc__&&t.$handle.removeField(e.__fc__)}),n.map(function(n){return z(n)?n:n.__fc__?t.renderParser(n.__fc__,e):void ce(function(){return t.$handle.reloadRule()})})):(i.forEach(function(e){!z(e)&&e.__fc__&&t.$handle.removeField(e.__fc__)}),this.orgChildren[e.id]=[],[])}},{key:"defaultRender",value:function(e,t){return this.vNode[e.type]?this.vNode[e.type](this.inputVData(e),t):this.vNode.make(e.type,this.inputVData(e),t)}}]),e}();var he=function(){function e(t){x(this,e);var n=t.vm,i=t.rules,r=t.options;this.vm=n,this.fc=t,this.id=X(),this.options=r,this.validate={},this.formData={},this.fCreateApi=void 0,this.__init(i),this.$form=new t.drive.formRender(this,this.id),this.$render=new fe(this),this.loadRule(this.rules,!1),this.$render.initOrgChildren(),this.$form.init()}return A(e,[{key:"__init",value:function(e){this.fieldList={},this.trueData={},this.parsers={},this.customData={},this.sortList=[],this.rules=e,this.origin=j(this.rules)}},{key:"loadRule",value:function(e,t){var n=this;e.map(function(e){if(!t||!z(e)){if(!e.type)return console.error("未定义生成规则的 type 字段"+Y());var i;if(e.__fc__){if((i=e.__fc__).vm!==n.vm&&!i.deleted)return console.error("".concat(e.type,"规则正在其他的 <form-create> 中使用")+Y());i.update(n)}else i=n.createParser(n.parseRule(e));var r=i.rule.children,o=i.rule;return n.notField(i.field)?(n.setParser(i),e.__fc__||function(e,t){Object.defineProperties(e,{__field__:{value:t.field,enumerable:!1,configurable:!1},__fc__:{value:t,enumerable:!1,configurable:!1}})}(e,i),F(r)&&n.loadRule(r,!0),t||n.sortList.push(i.id),n.isNoVal(i)||Object.defineProperty(i.rule,"value",{get:function(){return i.toValue(n.getFormData(i))},set:function(e){n.isChange(i,e)&&(n.$render.clearCache(i,!0),n.setFormData(i,i.toFormValue(e)))}}),i):console.error("".concat(o.field," 字段已存在")+Y())}}).filter(function(e){return e}).forEach(function(t){t.root=e})}},{key:"createParser",value:function(e){var t=this.id+""+X(),n=this.fc.parsers,i=V(e.type).toLocaleLowerCase();return new(n[i]?n[i]:le)(this,e,t)}},{key:"parseRule",value:function(e){var t={validate:[],col:{},emit:[],props:{},on:{},options:[],title:"",value:"",field:"",name:"",className:""},n=function(e){return U(e.getRule)?e.getRule():e}(e);Object.keys(t).forEach(function(e){T(n[e])&&R(n,e,t[e])});var i,r={options:(i=n.options,Array.isArray(i)?i:[])};return r.on=function(e,t){Object.keys(t).length>0&&B(e,t);return e}(n.on,this.parseEmit(n)),Object.keys(r).forEach(function(e){R(n,e,r[e])}),n}},{key:"parseEmit",value:function(e){var t=this,n={},i=e.emit,r=e.emitPrefix,o=e.field;return Array.isArray(i)?(i.forEach(function(e){var i,a,s=(i="".concat(r||o,"-").concat(e),a=i.replace(/([A-Z])/g,"-$1").toLowerCase(),0===a.indexOf("-")&&(a=a.substr(1)),a).replace("_","-");n[e]=function(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];(e=t.vm).$emit.apply(e,[s].concat(i))}}),n):n}},{key:"run",value:function(){return this.vm.unique>0?this.$render.run():(this.vm.unique=1,[])}},{key:"setParser",value:function(e){var t=e.id,n=e.field,i=e.name,r=e.rule;this.parsers[t]||(this.parsers[t]=e,this.isNoVal(e)?i&&R(this.customData,i,e):(this.fieldList[n]=e,R(this.formData,n,e.toFormValue(r.value)),R(this.validate,n,r.validate||[]),R(this.trueData,n,e)))}},{key:"notField",value:function(e){return void 0===this.parsers[e]}},{key:"isChange",value:function(e,t){return JSON.stringify(e.rule.value)!==JSON.stringify(t)}},{key:"onInput",value:function(e,t){!this.isNoVal(e)&&this.isChange(e,e.toValue(t))&&(this.$render.clearCache(e),this.setFormData(e,t))}},{key:"getParser",value:function(e){return this.fieldList[e]?this.fieldList[e]:this.customData[e]?this.customData[e]:this.parsers[e]?this.parsers[e]:void 0}},{key:"created",value:function(){var e=this.vm;e.$set(e,"buttonProps",this.options.submitBtn),e.$set(e,"resetProps",this.options.resetBtn),e.$set(e,"formData",this.formData),void 0===this.fCreateApi&&(this.fCreateApi=this.fc.drive.getGlobalApi(this)),this.fCreateApi.rule=this.rules,this.fCreateApi.config=this.options}},{key:"addParserWitch",value:function(e){var t=this,n=this.vm;Object.keys(e.rule).forEach(function(i){-1===["field","type","value","vm","template","name","config","children"].indexOf(i)&&void 0!==e.rule[i]&&e.watch.push(n.$watch(function(){return e.rule[i]},function(n,i){void 0!==i&&t.$render.clearCache(e)},{deep:!0,immediate:!0}))}),e.watch.push(n.$watch(function(){return e.rule.children},function(n,i){void 0!==i&&t.$render.clearCache(e,!0)}))}},{key:"mountedParser",value:function(){var e=this,t=this.vm;Object.keys(this.parsers).forEach(function(n){var i=e.parsers[n];0===i.watch.length&&e.addParserWitch(i),i.el=t.$refs[i.refName]||{},void 0===i.defaultValue&&(i.defaultValue=W({},{value:i.rule.value}).value),i.mounted&&i.mounted()})}},{key:"mounted",value:function(){var e=this.options.mounted;this.mountedParser(),e&&e(this.fCreateApi),this.fc.$emit("mounted",this.fCreateApi)}},{key:"reload",value:function(){var e=this.options.onReload;this.mountedParser(),e&&e(this.fCreateApi),this.fc.$emit("reload",this.fCreateApi)}},{key:"removeField",value:function(e){var t=e.id,n=e.field,i=this.sortList.indexOf(t);!function(e){e.watch.forEach(function(e){return e()}),e.watch=[],e.deleted=!0,Object.defineProperty(e.rule,"value",{value:B({},{value:e.rule.value}).value})}(e),E(this.parsers,t),E(this.validate,n),-1!==i&&this.sortList.splice(i,1),E(this.formData,n),E(this.customData,n),E(this.fieldList,n),E(this.trueData,n)}},{key:"refresh",value:function(){this.vm._refresh()}},{key:"reloadRule",value:function(e){var t=this,n=this.vm;if(!e)return this.reloadRule(this.rules);this.origin.length||this.fCreateApi.refresh(),this.origin=j(e);var i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){D(e,t,n[t])})}return e}({},this.parsers);this.__init(e),this.loadRule(e,!1),Object.keys(i).filter(function(e){return void 0===t.parsers[e]}).forEach(function(e){return t.removeField(i[e])}),this.$render.initOrgChildren(),this.created(),n.$nextTick(function(){t.reload()}),n.$f=this.fCreateApi,this.$render.clearCacheAll(),this.refresh()}},{key:"setFormData",value:function(e,t){this.formData[e.field]=t}},{key:"getFormData",value:function(e){return this.formData[e.field]}},{key:"fields",value:function(){return Object.keys(this.formData)}},{key:"isNoVal",value:function(e){return!e.isDef}}]),e}();var de="undefined"!=typeof window&&window.Vue?window.Vue:n;var pe=function(){function e(t){x(this,e),this.$handle=t,this.vm=t.vm,this.drive=this.$handle.fc.drive,this.options=t.options,this.vNode=new ue(this.vm),this.vData=new Q,this.unique=t.id}return A(e,[{key:"init",value:function(){this.$render=this.$handle.$render}},{key:"getGetCol",value:function(e){var t=e.rule.col||{},n={},i={};return this.options.global?(this.options.global["*"]&&(n=this.options.global["*"].col||{}),this.options.global[e.type]&&(i=this.options.global[e.type].col||{}),t=W(W(W({},n),i),t)):t}},{key:"beforeRender",value:function(){}},{key:"render",value:function(){}}]),e}();console.log("-----------------------------"),console.log("-----------------------------");var ve=new ue,me=function(e,t){return{name:"fc-modal",data:function(){return u({value:!0},e)},render:function(){return ve.setVm(this),ve.modal({props:this.$data,on:{"on-visible-change":this.remove}},[t(ve,this)])},methods:{onClose:function(){this.value=!1},remove:function(){this.$el.parentNode.removeChild(this.$el)}}}};function ye(e,t){var n=(new(de.extend(me(e,t)))).$mount();window.document.body.appendChild(n.$el)}function ge(e,t){ye({title:t,footerHide:!0},function(t){return t.make("img",{style:{width:"100%"},attrs:{src:e}})})}var be="fc-upload-btn",ke="fc-files",$e="__fc_h",we="__fc_v",_e="fc-upload",Oe="fc-upload-cover",Ce="fc-hide-btn";function xe(e,t,i){n.set(e,t,i)}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".fc-upload-btn, .fc-files {\n    display: inline-block;\n    width: 58px;\n    height: 58px;\n    text-align: center;\n    line-height: 58px;\n    border: 1px solid #c0ccda;\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fff;\n    position: relative;\n    box-shadow: 2px 2px 5px rgba(0, 0, 0, .1);\n    margin-right: 4px;\n    box-sizing: border-box;\n}\n\n.__fc_h {\n    display: none;\n}\n\n.__fc_v {\n    visibility: hidden;\n}\n\n.fc-files img {\n    width: 100%;\n    height: 100%;\n    display: inline-block;\n    vertical-align: top;\n}\n\n.fc-upload-btn {\n    border: 1px dashed #c0ccda;\n    cursor: pointer;\n}\n\n.fc-upload .fc-upload-cover {\n    opacity: 0;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0, 0, 0, .6);\n    transition: opacity .3s;\n}\n\n.fc-upload .fc-upload-cover i {\n    color: #fff;\n    font-size: 20px;\n    cursor: pointer;\n    margin: 0 2px;\n}\n\n.fc-files:hover .fc-upload-cover {\n    opacity: 1;\n}\n\n.fc-hide-btn .ivu-upload .ivu-upload {\n    display: none;\n}\n\n.fc-upload .ivu-upload-list {\n    margin-top: 0;\n}");var Pe=Object.prototype.toString;function Ae(e){return null==e?"":"object"===i(e)?JSON.stringify(e,null,2):String(e)}function De(e,t){return Pe.call(e)==="[object "+t+"]"}function Ie(e){return De(e,"Date")}function Le(e){return De(e,"Object")}function Se(e){return De(e,"Function")}function je(e){return Array.isArray(e)?e:null==e?[]:[e]}function Re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!1;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=t[i];if((n=Array.isArray(r))||Le(r)){var o=void 0===e[i];n?(n=!1,o&&xe(e,i,[])):o&&xe(e,i,{}),Re(e[i],r)}else xe(e,i,r)}return e}function Ee(e){if(Ie(e))return e;var t=new Date(e);return"Invalid Date"===t.toString()?e:t}function Fe(e){e.preventDefault()}function Ne(e){return"\ngithub:https://github.com/xaboy/form-create\ndocument:http://www.form-create.com"+(e||"")}function Te(e){return{url:e,name:Ve(e)}}function Ve(e){return Ae(e).split("/").pop()}var Be=[$,k({},void 0,{name:"fc-frame",props:{type:{type:String,default:"input"},field:{type:String,default:""},helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:O.fileUpIcon},width:{type:[Number,String],default:500},height:{type:[Number,String],default:370},maxLength:{type:Number,default:0},okBtnText:{type:String,default:"确定"},closeBtnText:{type:String,default:"关闭"},modalTitle:{type:String,default:"预览"},handleIcon:{type:[String,Boolean],default:""},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:function(){}},onOk:{type:Function,default:function(){}},onCancel:{type:Function,default:function(){}},onLoad:{type:Function,default:function(){}},onBeforeRemove:{type:Function,default:function(){}},onRemove:{type:Function,default:function(){}},onHandle:{type:Function,default:function(e){ge(e,this.title)}},value:[Array,String]},data:function(){return{modalVm:null,fileList:je(this.value)}},watch:{value:function(e){this.$emit("on-change",e),this.fileList=je(e)},fileList:function(e){this.$emit("input",1===this.maxLength?e[0]||"":e)}},methods:{closeModel:function(){this.modalVm&&this.modalVm.onClose(),this.modalVm=null},showModel:function(){var e=this;if(!this.disabled&&!1!==this.onOpen()){var t=this.$props,n=t.width,i=t.height,r=t.src,o=t.title,a=t.okBtnText,s=t.closeBtnText;ye({width:n,title:o},function(t,n){return e.modalVm=n,[t.make("iframe",{attrs:{src:r},style:{height:i,border:"0 none",width:"100%"},on:{load:function(t){e.onLoad(t);try{if(!0===e.helper)t.path[0].contentWindow.form_create_helper={close:function(t){e.valid(t),n.onClose()},set:function(t,n){e.valid(t),e.$emit("input",n)},get:function(t){return e.valid(t),e.value}}}catch(t){console.log(t)}}}}),t.make("div",{slot:"footer"},[t.button({on:{click:function(){n.onClose(),e.onCancel()}}},[s]),t.button({props:{type:"primary"},on:{click:function(){!1!==e.onOk()&&n.onClose()}}},[a])])]})}},makeInput:function(e){var t=this,n=this.$createElement,i={type:"text",value:this.fileList.toString(),icon:this.icon,readonly:!0,clearable:!1};return n("Input",b([{style:e?"display:none;":""},{props:i},{},{on:{"on-click":function(){return t.showModel()}}}]))},makeGroup:function(e){var t=this.$createElement;return(!this.maxLength||this.fileList.length<this.maxLength)&&e.push(this.makeBtn()),e.push(this.makeInput(!0)),t("div",{class:_e},d(e))},makeItem:function(e){return(0,this.$createElement)("div",{class:ke},d(e))},valid:function(e){if(e!==this.field)throw new Error("form-create:无效的表单字段")},makeIcons:function(e){var t=this.$createElement;if(!1!==this.handleIcon||!0===this.allowRemove){var n=[];return("file"!==this.type&&!1!==this.handleIcon||"file"===this.type&&this.handleIcon)&&n.push(this.makeHandleIcon(e)),this.allowRemove&&n.push(this.makeRemoveIcon(e)),t("div",{class:Oe},[n])}},makeHandleIcon:function(e){var t=this;return(0,this.$createElement)("icon",b([{},{props:{type:!0===this.handleIcon?"ios-eye-outline":this.handleIcon}},{on:{click:function(){return t.handleClick(e)}}}]))},makeRemoveIcon:function(e){var t=this;return(0,this.$createElement)("icon",b([{},{props:{type:"ios-trash-outline"}},{on:{click:function(){return t.handleRemove(e)}}}]))},makeFiles:function(){var e=this,t=this.$createElement;return this.makeGroup(this.fileList.map(function(n){return e.makeItem([t("icon",b([{},{props:{type:O.fileIcon,size:40}},{on:{click:function(){return e.handleClick(n)}}}])),e.makeIcons(n)])}))},makeImages:function(){var e=this,t=this.$createElement;return this.makeGroup(this.fileList.map(function(n){return e.makeItem([t("img",{attrs:{src:n}}),e.makeIcons(n)])}))},makeBtn:function(){var e=this,t=this.$createElement;return t("div",{class:be,on:{click:function(){return e.showModel()}}},[t("icon",b([{},{props:{type:this.icon,size:20}}]))])},handleClick:function(e){if(!this.disabled)return this.onHandle(e)},handleRemove:function(e){this.disabled||!1!==this.onBeforeRemove(e)&&(this.fileList.splice(this.fileList.indexOf(e),1),this.onRemove(e))}},render:function(){var e=this.type;return"input"===e?this.makeInput():"image"===e?this.makeImages():this.makeFiles()}},void 0,void 0,void 0,void 0,void 0),k({},void 0,{name:"fc-radio",functional:!0,props:{options:{type:Array,default:function(){return[]}}},render:function(e,t){return e("RadioGroup",b([{},t.data]),[t.props.options.map(function(t){var n=u({},t);return delete n.value,e("Radio",{props:u({},n)})}).concat(t.chlidren)])}},void 0,void 0,void 0,void 0,void 0),k({},void 0,{name:"fc-select",functional:!0,props:{options:{type:Array,default:function(){return[]}}},render:function(e,t){return e("Select",b([{},t.data]),[t.props.options.map(function(n,i){var r=n.slot?function(e,t){return[e&&Se(e)?e(t):e]}(n.slot,e):[];return e("Option",{props:u({},n),key:"t".concat(i).concat(t._uid)},[r])}).concat(t.chlidren)])}},void 0,void 0,void 0,void 0,void 0),k({},void 0,{name:"fc-tree",props:{ctx:{type:Object,default:function(){return{props:{}}}},children:{type:Array,default:function(){return[]}},type:{type:String,default:"checked"},value:{type:Array,default:function(){return[]}}},data:function(){return{treeData:[]}},watch:{value:function(e){e=je(e);var t=this.$refs.tree.data;"selected"===this.type?this.selected(t,e):this.checked(t,e)}},methods:{selected:function(e,t){var n=this;e.forEach(function(e){n.$set(e,"selected",-1!==t.indexOf(e.id)),void 0!==e.children&&Array.isArray(e.children)&&n.selected(e.children,t)})},checked:function(e,t){var n=this;e.forEach(function(e){-1!==t.indexOf(e.id)?n.$set(e,"checked",!0):(n.$set(e,"indeterminate",!1),n.$set(e,"checked",!1)),void 0!==e.children&&Array.isArray(e.children)&&n.checked(e.children,t)})},makeTree:function(){return(0,this.$createElement)("Tree",b([{ref:"tree"},this.ctx]),[this.children])},updateTreeData:function(){var e=this.type.toLocaleLowerCase();this.treeData="selected"===e?this.$refs.tree.getSelectedNodes():"indeterminate"===e?this.$refs.tree.getCheckedAndIndeterminateNodes():this.$refs.tree.getCheckedNodes(),this.$emit("input",this.treeData.map(function(e){return e.id}))}},render:function(){return(0,arguments[0])("div",[this.makeTree()])},mounted:function(){var e=this;this.$nextTick(function(){e.$watch(function(){return e.$refs.tree.flatState},function(){return e.updateTreeData()})})}},void 0,void 0,void 0,void 0,void 0),k({},void 0,{name:"fc-upload",props:{ctx:{type:Object,default:function(){return{props:{}}}},children:{type:Array,default:function(){return[]}},onHandle:{type:Function,default:function(e){ge(e.url,this.modalTitle)}},uploadType:{type:String,default:"file"},maxLength:{type:Number,default:0},allowRemove:{type:Boolean,default:!0},modalTitle:{type:String,default:"预览"},handleIcon:[String,Boolean],value:[Array,String]},data:function(){return{uploadList:[]}},created:function(){void 0===this.ctx.props.showUploadList&&(this.ctx.props.showUploadList=!1),this.ctx.props.defaultFileList=je(this.value).map(Te)},watch:{value:function(e){this.$refs.upload.fileList=je(e).map(Te),this.uploadList=this.$refs.upload.fileList},maxLength:function(e,t){1!==t&&1!==e||this.update()}},methods:{isDisabled:function(){return!0===this.ctx.props.disabled},onRemove:function(e){this.isDisabled()||this.$refs.upload.handleRemove(e)},handleClick:function(e){this.isDisabled()||this.onHandle(e)},makeDefaultBtn:function(){var e=this.$createElement;return e("div",{class:be},[e("icon",b([{},{props:{type:"file"===this.uploadType?"ios-cloud-upload-outline":O.imgUpIcon,size:20}}]))])},makeItem:function(e){var t=this.$createElement;return"image"===this.uploadType?t("img",{attrs:{src:e.url}}):t("icon",b([{},{props:{type:O.fileIcon,size:40}}]))},makeRemoveIcon:function(e){var t=this;return(0,this.$createElement)("icon",{attrs:{type:"ios-trash-outline"},on:{click:function(){return t.onRemove(e)}}})},makeHandleIcon:function(e){var t=this;return(0,this.$createElement)("icon",{attrs:{type:!0===this.handleIcon?"ios-eye-outline":this.handleIcon},on:{click:function(){return t.handleClick(e)}}})},makeProgress:function(e){return(0,this.$createElement)("Progress",b([{},{props:{percent:e.percentage,hideInfo:!0}},{style:"width:90%"}]))},makeIcons:function(e){var t=this.$createElement,n=[];if(this.allowRemove||this.handleIcon)return this.handleIcon&&n.push(this.makeHandleIcon(e)),this.allowRemove&&n.push(this.makeRemoveIcon(e)),t("div",{class:Oe},[n])},makeFiles:function(){var e=this,t=this.$createElement;return this.uploadList.map(function(n){return t("div",{class:ke},[n.showProgress?e.makeProgress(n):[e.makeItem(n),e.makeIcons(n)]])})},makeUpload:function(){return(0,this.$createElement)("Upload",b([{ref:"upload",style:{display:"inline-block"}},this.ctx]),[this.children])},initChildren:function(){var e,t;e=this.children,t="default",0!==e.length&&e.some(function(e){if(e.data){if(!e.data.slot&&"default"===t||e.data.slot===t)return!0}else if("default"===t)return!0;return!1})||this.children.push(this.makeDefaultBtn())},update:function(){var e=this.$refs.upload.fileList.map(function(e){return e.url}).filter(function(e){return void 0!==e});this.$emit("input",1===this.maxLength?e[0]||"":e)}},render:function(){var e,t=arguments[0],n=!this.maxLength||this.maxLength>this.uploadList.length;return this.$refs.upload&&(void 0===this.ctx.props.showUploadList&&(this.ctx.props.showUploadList=this.$refs.upload.showUploadList),this.ctx.props.defaultFileList=this.$refs.upload.defaultFileList),this.initChildren(),t("div",{class:(e={},s(e,_e,!0),s(e,Ce,!n),e)},[[this.ctx.props.showUploadList?[]:this.makeFiles(),this.makeUpload()]])},mounted:function(){var e=this;this.uploadList=this.$refs.upload.fileList,this.$watch(function(){return e.$refs.upload.fileList},function(){e.update()},{deep:!0})}},void 0,void 0,void 0,void 0,void 0)];function qe(e){return Ie(e)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,n={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[i]:("00"+n[i]).substr((""+n[i]).length)));return e}("hh:mm:ss",e):e}var Me=[{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"render",value:function(e){var t=this;return this.vNode.checkbox({props:{ctx:this.$render.inputVData(this,!0).get(),options:this.rule.options,value:this.$handle.getFormData(this),children:e},on:{input:function(e){t.$render.onInput(t,e)}}})}}]),t}(),name:"checkbox"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"init",value:function(){var e=this.rule.props;e.startDate&&xe(e,"startDate",Ee(e.startDate))}},{key:"toFormValue",value:function(e){var t,n=Array.isArray(e),i=this.rule.props,r=i.type||"date";return t=-1!==["daterange","datetimerange"].indexOf(r)?n?e.map(function(e){return e?Ee(e):""}):["",""]:"date"===r&&!0===i.multiple?Ae(e):(t=n?e[0]||"":e)?Ee(t):""}},{key:"mounted",value:function(){var e=this;this.toValue=function(){return e.el.publicStringValue}}}]),t}(),name:"datePicker"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"render",value:function(e){var t=this.$render.inputVData(this).props("field",this.field);return this.vNode.frame(t,e)}},{key:"closeModel",value:function(){this.el.closeModel&&this.el.closeModel()}}]),t}(),name:"frame"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"render",value:function(){return[]}}]),t}(),name:"hidden"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"init",value:function(){var e=this.rule.props;e.autosize&&e.autosize.minRows&&xe(e,"rows",e.autosize.minRows||2)}}]),t}(),name:"input"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"toFormValue",value:function(e){return this.rule.options.filter(function(t){return t.value===e}).reduce(function(e,t){return t.label},"")}},{key:"toValue",value:function(e){return this.rule.options.filter(function(t){return t.label===e}).reduce(function(e,t){return t.value},"")}},{key:"render",value:function(e){return this.vNode.radio(this.$render.inputVData(this).props({options:this.rule.options}),e)}}]),t}(),name:"radio"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"render",value:function(e){return this.vNode.select(this.$render.inputVData(this).props("options",this.rule.options),e)}}]),t}(),name:"select"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"toFormValue",value:function(e){var t=this.rule,n=Array.isArray(e),i=t.props,r=i.min||0;return!0===i.range?n?e:[r,parseFloat(e)||r]:n?parseFloat(e[0])||r:parseFloat(e)}}]),t}(),name:"slider"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"render",value:function(e){var t=this.rule.props.slot||{};return this.vNode.switch(this.$render.inputVData(this).scopedSlots({open:function(){return t.open},close:function(){return t.close}}).get(),e)}}]),t}(),name:"switch"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"toFormValue",value:function(e){var t,n=Array.isArray(e);return"timerange"===this.rule.props.type?t=n?e.map(function(e){return e?qe(Ee(e)):""}):["",""]:(n&&(e=e[0]),t=e?qe(Ee(e)):""),t}},{key:"mounted",value:function(){var e=this;this.toValue=function(){return e.el.publicStringValue}}}]),t}(),name:"timePicker"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"toValue",value:function(e){var t,n=e;return(t=this.rule).props.multiple||"selected"!==t.props.type?n:n[0]||""}},{key:"render",value:function(e){var t=this,n=this.$render.parserToData(this).get();return this.vNode.tree({props:{ctx:n,children:e,value:this.$handle.getFormData(this),type:n.props.type},ref:this.refName,key:this.key,on:{input:function(e){t.$render.onInput(t,e)}}})}}]),t}(),name:"tree"},{parser:function(e){function t(){return r(this,t),h(this,c(t).apply(this,arguments))}return l(t,le),a(t,[{key:"render",value:function(e){var t=this,n=this.$render.parserToData(this).get(),i=this.key,r=this.refName;delete n.props.defaultFileList;var o={uploadType:n.props.uploadType,maxLength:n.props.maxLength,modalTitle:n.props.modalTitle,handleIcon:n.props.handleIcon,onHandle:n.props.onHandle,allowRemove:n.props.allowRemove,value:this.$handle.getFormData(this),ctx:n,key:i,ref:r,children:e};return this.vNode.upload({props:o,on:{input:function(e){t.$render.onInput(t,e)}}})}}]),t}(),name:"upload"}];var Ue=function(e){function t(e){var n;return r(this,t),(n=h(this,c(t).call(this,e))).refName="cForm".concat(n.id),n.hidden=[],n.visibility=[],n}return l(t,pe),a(t,[{key:"getFormRef",value:function(){return this.vm.$refs[this.refName]}},{key:"beforeRender",value:function(){this.propsData=this.vData.props(this.options.form).props({model:this.$handle.formData,rules:this.$handle.validate,key:"form"+this.unique}).ref(this.refName).nativeOn({submit:Fe}).class("form-create",!0).key(this.unique).get()}},{key:"render",value:function(e){return e.length>0&&e.push(this.makeFormBtn()),this.vNode.form(this.propsData,[this.makeRow(e)])}},{key:"makeRow",value:function(e){return this.vNode.row({props:this.options.row||{},key:"fr"+this.unique},e)}},{key:"container",value:function(e,t){return this.makeFormItem(t,e)}},{key:"makeFormItem",value:function(e,t){var n="fItem".concat(e.key).concat(this.unique),i=e.rule,r=e.field,o=e.formItemRefName,a=this.getGetCol(e),s=a.labelWidth||i.title?a.labelWidth:1,u=i.className,l=this.vData.props({prop:r,label:i.title,rules:i.validate,labelWidth:s,required:i.props.required}).key(n).ref(o).class(u).get(),c=this.vNode.formItem(l,[t]);return!0===this.propsData.props.inline?c:this.makeCol(a,e,n,[c])}},{key:"makeCol",value:function(e,t,n,i){var r;return void 0===e.span&&(e.span=24),this.vNode.col({props:e,class:(r={},s(r,$e,-1!==this.hidden.indexOf(t)),s(r,we,-1!==this.visibility.indexOf(t)),r),key:"".concat(n,"col1")},i)}},{key:"makeFormBtn",value:function(){var e=[],t=!1!==this.vm.buttonProps&&!1!==this.vm.buttonProps.show,n=!1!==this.vm.resetProps&&!1!==this.vm.resetProps.show;return t&&e.push(this.makeSubmitBtn(n?19:24)),n&&e.push(this.makeResetBtn(4)),!0===this.propsData.props.inline?e:this.vNode.col({props:{span:24},key:"".concat(this.unique,"col2")},e)}},{key:"makeResetBtn",value:function(e){var t=this,n=this.$handle.options.resetBtn,i=n.col||{span:e,push:1};return this.vNode.col({props:i,key:"".concat(this.unique,"col3")},[this.vNode.button({key:"frsbtn".concat(this.unique),props:this.vm.resetProps,on:{click:function(){var e=t.$handle.fCreateApi;Se(n.click)?n.click(e):e.resetFields()}}},[this.vm.resetProps.innerText])])}},{key:"makeSubmitBtn",value:function(e){var t=this,n=this.$handle.options.submitBtn,i=n.col||{span:e};return this.vNode.col({props:i,key:"".concat(this.unique,"col4")},[this.vNode.button({key:"fbtn".concat(this.unique),props:this.vm.buttonProps,on:{click:function(){var e=t.$handle.fCreateApi;Se(n.click)?n.click(e):e.submit()}}},[this.vm.buttonProps.innerText])])}}]),t}(),ze=["date","dateRange","dateTime","dateTimeRange","year","month"].reduce(function(e,t){return e[t]=te("datePicker",t.toLowerCase()),e},{}),Ge={frameInputs:["input",0],frameFiles:["file",0],frameImages:["image",0],frameInputOne:["input",1],frameFileOne:["file",1],frameImageOne:["image",1]},He=Object.keys(Ge).reduce(function(e,t){return e[t]=te("frame",function(e){return e.props({type:Ge[t][0],maxLength:Ge[t][1]})}),e},{});He.frameInput=He.frameInputs,He.frameFile=He.frameFiles,He.frameImage=He.frameImages;var We=["password","url","email","text","textarea"].reduce(function(e,t){return e[t]=te("input",t),e},{});We.idate=te("input","date");var Je={selectMultiple:te("select",!0,"multiple"),selectOne:te("select",!1,"multiple")},Xe={sliderRange:te("slider",!0,"range")},Ye={time:te("timePicker","time"),timeRange:te("timePicker","timerange")},Ze={treeSelected:"selected",treeChecked:"checked"},Ke=Object.keys(Ze).reduce(function(e,t){return e[t]=te("tree",Ze[t]),e},{}),Qe={image:["image",0],file:["file",0],uploadFileOne:["file",1],uploadImageOne:["image",1]},et=Object.keys(Qe).reduce(function(e,t){return e[t]=te("upload",function(e){return e.props({uploadType:Qe[t][0],maxLength:Qe[t][1]})}),e},{});et.uploadImage=et.image,et.uploadFile=et.file;var tt=u({},ze,He,We,Je,Xe,Ye,Ke,et);["autoComplete","cascader","colorPicker","datePicker","frame","inputNumber","radio","rate"].forEach(function(e){tt[e]=ee(e)}),tt.auto=tt.autoComplete,tt.number=tt.inputNumber,tt.color=tt.colorPicker,tt.hidden=function(e,t){return ee("hidden")("",e,t)},ue.use({modal:"Modal",progress:"i-progress",button:"i-button",icon:"Icon",slider:"Slider",rate:"Rate",upload:"fc-upload",cascader:"Cascader",colorPicker:"Color-Picker",timePicker:"Time-Picker",datePicker:"Date-Picker",switch:"i-switch",option:"i-option",select:"fc-select",checkbox:"fc-checkbox",checkboxGroup:"Checkbox-Group",radio:"fc-radio",radioGroup:"Radio-Group",inputNumber:"Input-Number",input:"i-input",formItem:"Form-Item",form:"i-form",frame:"fc-frame",col:"i-col",row:"row",tree:"fc-tree",autoComplete:"AutoComplete"});var nt=function(e){var t={},n={},i=function(){var e={},t=ee("");return B(e,{create:function(e,n,i){var r=t("",n);return r._data.type=e,r._data.title=i,r},createTmp:function(e,n,i,r){var o=t("",i);return o._data.type="template",o._data.template=e,o._data.title=r,o._data.vm=n,o}}),e.template=e.createTmp,e.parse=ie,e}(),r=e.getConfig();function o(e,t){e=V(e),n[e.toLocaleLowerCase()]=t,c.maker[e]=ee(e)}function a(e,n){var i=(e=V(e)).toLocaleLowerCase();return"form-create"===i||"formcreate"===i?de.extend(K(c,t)):void 0===n?t[V(e)]:void(t[V(e)]=n)}function s(e,t){G(t.sumbitBtn)&&(t.sumbitBtn={show:t.sumbitBtn}),G(t.resetBtn)&&(t.resetBtn={show:t.resetBtn});var n=W(e,t);return R(n,"el",n.el?H(n.el)?n.el:document.querySelector(n.el):window.document.body),n}function u(n){B(n,{version:e.version,ui:e.ui,maker:i,component:a,setParser:o,$formCreate:function(){return K(n,t)}})}function l(e,t){var n=new de({data:function(){return{rule:e,option:H(t)?{el:t}:t}},render:function(){return(0,arguments[0])("form-create",b([{ref:"fc"},{props:this.$data}]))}});return n.$mount(),n}var c=function(){function i(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,i),this.fCreateApi=void 0,this.drive=e,this.parsers=n,this.vm=void 0,this.rules=Array.isArray(t)?t:[],this.options=s(W({},r),o)}return A(i,[{key:"beforeCreate",value:function(e){this.vm=e,this.handle=new he(this)}},{key:"created",value:function(){this.handle.created()}},{key:"api",value:function(){return this.handle.fCreateApi}},{key:"render",value:function(){return this.handle.run()}},{key:"mounted",value:function(){this.handle.mounted()}},{key:"$emit",value:function(e){for(var t,n,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];this.$parent&&(t=this.$parent).$emit.apply(t,["fc:".concat(e)].concat(r)),(n=this.vm).$emit.apply(n,[e].concat(r))}}],[{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=l(e,t),r=i.$refs.fc.formCreate;return r.parent=n,r.options.el.appendChild(i.$el),r.handle.fCreateApi}},{key:"install",value:function(e){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.create(e,t,this)};u(n),e.prototype.$formCreate=n,e.component(Z,e.extend(K(i,t))),de=e}},{key:"init",value:function(e){var t=l(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=t.$refs.fc.formCreate;return{mount:function(e){return e&&H(e)&&(n.options.el=e),n.options.el.appendChild(t.$el),n.handle.fCreateApi},remove:function(){n.options.el.removeChild(t.$el)},$f:n.handle.fCreateApi}}}]),i}();return u(c),e.components.forEach(function(e){c.component(e.name,e)}),e.parsers.forEach(function(e){var t=e.name,n=e.parser;c.setParser(t,n)}),Object.keys(e.makers).forEach(function(t){c.maker[t]=e.makers[t]}),{FormCreate:c,install:function(e,t){!0!==e._installedFormCreate&&(e._installedFormCreate=!0,t&&M(t)&&s(r,t),e.use(c))}}}({ui:"iview",version:"2.0.0-bata.1",formRender:Ue,components:Be,parsers:Me,makers:tt,getGlobalApi:function(e){function t(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?Array.isArray(t)||(t=[t]):t=n?Object.keys(e.fieldList):e.fields(),t}return{formData:function(){var t=e.fieldList;return Object.keys(t).reduce(function(e,n){var i=t[n];return e[i.field]=Re({},{value:i.rule.value}).value,e},{})},getValue:function(t){t=Ae(t);var n=e.fieldList[t];if(n)return Re({},{value:n.rule.value}).value},setValue:function(t,n){var i=t;Le(t)||(i=s({},t,n)),Object.keys(i).forEach(function(t){var n=e.fieldList[t];n&&(n.rule.value=i[t])})},changeValue:function(e,t){this.setValue(e,t)},changeField:function(e,t){this.setValue(e,t)},removeField:function(t){var n=e.fieldList[t];if(n){var i=n.root.map(function(e){return e.__field__}).indexOf(Ae(t));-1!==i&&(n.root.splice(i,1),-1===e.sortList.indexOf(n.id)&&this.reload())}},validate:function(t){e.$form.getFormRef().validate(function(e){t&&t(e)})},validateField:function(t,n){e.fieldList[t]&&e.$form.getFormRef().validateField(t,n)},resetFields:function(n){var i=e.fieldList;t(n,!0).forEach(function(t){var n=i[t];n&&"hidden"!==n.type&&(e.vm.$refs[n.formItemRefName].resetField(),e.$render.clearCache(n,!0))})},destroy:function(){e.vm.$el.parentNode.removeChild(e.vm.$el),e.vm.$destroy()},fields:function(){return e.fields()},append:function(t,n,i){var r=e.fieldList,o=e.sortList.length,a=e.rules;if(n=Ae(n),t.field&&-1!==r.indexOf(Ae(t.field)))return console.error("".concat(t.field," 字段已存在")+Ne());var s=e.getParser(n);s&&(i?(a=s.rule.children,o=s.rule.children.length):o=s.root.indexOf(s.rule)),a.splice(o+1,0,t)},prepend:function(t,n,i){var r=e.fieldList,o=0,a=e.rules;if(n=Ae(n),t.field&&-1!==r.indexOf(Ae(t.field)))return console.error("".concat(t.field," 字段已存在")+Ne());var s=e.getParser(n);s&&(i?a=s.rule.children:o=s.root.indexOf(s.rule)),a.splice(o,0,t)},submit:function(t,n){var i=this;this.validate(function(r){if(r){var o=i.formData();Se(t)?t(o,i):(e.options.onSubmit&&e.options.onSubmit(o,i),e.fc.$emit("submit",o,i))}else n&&n(i)})},hidden:function(n,i){var r=e.$render.form.hidden;t(i,!0).forEach(function(t){var i=e.fieldList[t];i&&(n?r.push(i):r.splice(r.indexOf(i),1),e.$render.clearCache(i,!0))}),e.refresh()},visibility:function(n,i){var r=e.$render.form.visibility;t(i,!0).forEach(function(t){var i=e.fieldList[t];i&&(n?r.push(i):r.splice(r.indexOf(i),1),e.$render.clearCache(i,!0))}),e.refresh()},disabled:function(n,i){t(i,!0).forEach(function(t){var i=e.fieldList[t];i&&e.vm.$set(i.rule.props,"disabled",!!n)})},clearValidateState:function(n){t(n).forEach(function(t){var n=e.fieldList[t];if(n){var i=e.vm.$refs[n.formItemRefName];i&&(i.validateMessage="",i.validateState="")}})},model:function(){return Object.keys(e.trueData).reduce(function(t,n){return t[n]=e.trueData[n].rule,t},{})},component:function(){return Object.keys(e.customData).reduce(function(t,n){return t[n]=e.customData[n].rule,t},{})},bind:function(){var t={},n={};return Object.keys(e.fieldList).forEach(function(t){var i=e.fieldList[t];n[t]={get:function(){return i.rule.value},set:function(e){i.rule.value=e},enumerable:!0,configurable:!0}}),Object.defineProperties(t,n),t},submitBtnProps:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.vm._buttonProps(t)},resetBtnProps:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.vm._resetProps(t)},btn:{loading:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.vm._buttonProps({loading:!!t})},finish:function(){this.loading(!1)},disabled:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.vm._buttonProps({disabled:!!t})},show:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.vm._buttonProps({show:!!t})}},resetBtn:{loading:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.vm._resetProps({loading:!!t})},finish:function(){this.loading(!1)},disabled:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.vm._resetProps({disabled:!!t})},show:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.vm._resetProps({show:!!t})}},closeModal:function(t){var n=e.fieldList[t];n&&n.closeModel&&n.closeModel()},set:function(t,n,i){e.vm.$set(t,n,i)},reload:function(t){e.reloadRule(t)},updateOptions:function(t){Re(e.options,t),this.refresh(!0)},onSubmit:function(e){this.options({onSubmit:e})},sync:function(t){var n=e.getParser(Ae(t));n&&(e.$render.clearCache(n,!0),e.refresh(!0))},refresh:function(t){t&&e.$render.clearCacheAll(),e.refresh()},hideForm:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.vm.isShow=!!t}}},getConfig:function(){return{form:{inline:!1,labelPosition:"right",labelWidth:125,showMessage:!0,autocomplete:"off",size:void 0},row:{gutter:0,type:void 0,align:void 0,justify:void 0,className:void 0},submitBtn:{type:"primary",size:"large",shape:void 0,long:!0,htmlType:"button",disabled:!1,icon:O.submitBtnIcon,innerText:"提交",loading:!1,show:!0,col:void 0,click:void 0},resetBtn:{type:O.resetBtnType,size:"large",shape:void 0,long:!0,htmlType:"button",disabled:!1,icon:O.resetBtnIcon,innerText:"重置",loading:!1,show:!1,col:void 0,click:void 0}}}}),it=nt.FormCreate,rt=nt.install;"undefined"!=typeof window&&(window.formCreate=it,window.Vue&&rt(window.Vue));var ot=it.maker;e.default=it,e.maker=ot,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=form-create.iview.min.js.map
